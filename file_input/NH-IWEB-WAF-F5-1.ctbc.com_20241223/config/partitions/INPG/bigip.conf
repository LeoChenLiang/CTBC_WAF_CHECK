#TMSH-VERSION: 17.1.1.3

apm client-packaging /INPG/client-packaging { }
apm resource sandbox /INPG/citrix-client-package {
    base-uri /INPG/public/citrix
    description "Sandbox for Citrix client package files"
}
apm resource sandbox /INPG/hosted-content {
    base-uri /INPG/public/share
    description "Sandbox for static contents"
}
asm policy /INPG/SP_INNFI_NOTIFY {
    active
    encoding utf-8
}
asm policy /INPG/SP_INNFI_TRANS {
    active
    encoding utf-8
}
asm policy /INPG/SP_INPG {
    active
    encoding utf-8
}
ltm node /INPG/10.23.40.145 {
    address 10.23.40.145
}
ltm node /INPG/10.23.40.146 {
    address 10.23.40.146
}
ltm node /INPG/10.23.40.155 {
    address 10.23.40.155
}
ltm node /INPG/10.23.40.156 {
    address 10.23.40.156
}
ltm node /INPG/10.23.86.140 {
    address 10.23.86.140
}
ltm node /INPG/10.23.86.142 {
    address 10.23.86.142
}
ltm node /INPG/10.24.68.101 {
    address 10.24.68.101
}
ltm node /INPG/10.24.68.102 {
    address 10.24.68.102
}
ltm node /INPG/10.24.68.103 {
    address 10.24.68.103
}
ltm node /INPG/10.24.68.104 {
    address 10.24.68.104
}
ltm node /INPG/10.24.68.105 {
    address 10.24.68.105
}
ltm node /INPG/10.24.68.106 {
    address 10.24.68.106
}
ltm node /INPG/10.24.68.107 {
    address 10.24.68.107
}
ltm node /INPG/10.24.68.108 {
    address 10.24.68.108
}
ltm node /INPG/10.24.68.109 {
    address 10.24.68.109
}
ltm node /INPG/10.24.68.207 {
    address 10.24.68.207
}
ltm node /INPG/10.24.68.208 {
    address 10.24.68.208
}
ltm node /INPG/10.24.68.215 {
    address 10.24.68.215
}
ltm node /INPG/10.24.68.216 {
    address 10.24.68.216
}
ltm node /INPG/10.24.69.187 {
    address 10.24.69.187
}
ltm node /INPG/10.24.69.188 {
    address 10.24.69.188
}
ltm node /INPG/10.24.71.127 {
    address 10.24.71.127
}
ltm node /INPG/10.24.71.128 {
    address 10.24.71.128
}
ltm node /INPG/10.243.136.17 {
    address 10.243.136.17
}
ltm node /INPG/10.243.136.18 {
    address 10.243.136.18
}
ltm node /INPG/10.248.73.59 {
    address 10.248.73.59
}
ltm node /INPG/10.248.73.60 {
    address 10.248.73.60
}
ltm node /INPG/10.248.73.61 {
    address 10.248.73.61
}
ltm node /INPG/10.248.73.62 {
    address 10.248.73.62
}
ltm node /INPG/192.168.168.84 {
    address 192.168.168.84
}
ltm node /INPG/192.168.168.85 {
    address 192.168.168.85
}
ltm node /INPG/caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com {
    fqdn {
        address-family all
        autopopulate enabled
        name caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com
    }
}
ltm policy /INPG/asm_auto_l7_policy__VS_INNFI_443_NFICTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INNFI_TRANS
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INNFI_6443_NEW {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INNFI_NOTIFY
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_443 {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_443_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_443_internet {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_443_internet_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443 {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443_internet {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443_internet_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_PG_8443_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443 {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443_internet {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443_internet_CTBC {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /INPG/asm_auto_l7_policy__vs_inos_internal_80 {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /INPG/SP_INPG
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm pool /INPG/POOL_CAIP_Parking_AP {
    description POOL_CAIP_Parking_AP
    members {
        /INPG/caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com:80 {
            description caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com
            fqdn {
                autopopulate enabled
                name caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com
            }
        }
    }
    monitor /Common/http
}
ltm pool /INPG/POOL_INNFI_JWPAY {
    members {
        /INPG/10.23.40.155:38080 {
            address 10.23.40.155
        }
        /INPG/10.23.40.156:38080 {
            address 10.23.40.156
        }
    }
    monitor /Common/tcp and /INPG/INNFI_JWPAY_MONITOR
}
ltm pool /INPG/POOL_INPG_EDC_B24_19010 {
    members {
        /INPG/10.248.73.59:19010 {
            address 10.248.73.59
        }
        /INPG/10.248.73.60:19010 {
            address 10.248.73.60
        }
        /INPG/10.248.73.61:19010 {
            address 10.248.73.61
        }
        /INPG/10.248.73.62:19010 {
            address 10.248.73.62
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_EDC_CERC_15050 {
    members {
        /INPG/10.248.73.59:15050 {
            address 10.248.73.59
        }
        /INPG/10.248.73.60:15050 {
            address 10.248.73.60
        }
        /INPG/10.248.73.61:15050 {
            address 10.248.73.61
        }
        /INPG/10.248.73.62:15050 {
            address 10.248.73.62
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_EDC_TMS_18900 {
    members {
        /INPG/10.248.73.59:18900 {
            address 10.248.73.59
        }
        /INPG/10.248.73.60:18900 {
            address 10.248.73.60
        }
        /INPG/10.248.73.61:18900 {
            address 10.248.73.61
        }
        /INPG/10.248.73.62:18900 {
            address 10.248.73.62
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_EDC_TMS_18910 {
    members {
        /INPG/10.248.73.59:18910 {
            address 10.248.73.59
        }
        /INPG/10.248.73.60:18910 {
            address 10.248.73.60
        }
        /INPG/10.248.73.61:18910 {
            address 10.248.73.61
        }
        /INPG/10.248.73.62:18910 {
            address 10.248.73.62
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_EDC_TMS_18913 {
    members {
        /INPG/10.248.73.59:18913 {
            address 10.248.73.59
        }
        /INPG/10.248.73.60:18913 {
            address 10.248.73.60
        }
        /INPG/10.248.73.61:18913 {
            address 10.248.73.61
        }
        /INPG/10.248.73.62:18913 {
            address 10.248.73.62
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_HYPOS_AP {
    members {
        /INPG/10.24.68.101:2011 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.101:2012 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:2011 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:2012 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:2011 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:2012 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:2011 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:2012 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:2011 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MAEGW {
    members {
        /INPG/10.24.68.104:9093 {
            address 10.24.68.104
        }
        /INPG/10.24.68.107:9093 {
            address 10.24.68.107
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MCLOUD {
    description POOL_INPG_MCLOUD
    members {
        /INPG/10.24.68.101:9100 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9100 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9100 {
            address 10.24.68.103
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MFastPay {
    members {
        /INPG/10.24.68.101:9950 {
            address 10.24.68.101
        }
        /INPG/10.24.68.101:9951 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9950 {
            address 10.24.68.102
        }
        /INPG/10.24.68.102:9951 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9950 {
            address 10.24.68.103
        }
        /INPG/10.24.68.103:9951 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9950 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9950 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MICROPAY_AP {
    members {
        /INPG/10.24.68.101:9991 {
            address 10.24.68.101
        }
        /INPG/10.24.68.102:9990 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9991 {
            address 10.24.68.102
        }
        /INPG/10.24.68.103:9990 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9991 {
            address 10.24.68.103
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI2_GW {
    members {
        /INPG/10.24.68.101:9083 {
            address 10.24.68.101
        }
        /INPG/10.24.68.102:9083 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9083 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.69.187:9083 {
            address 10.24.69.187
            session user-disabled
            state user-down
        }
        /INPG/10.24.69.187:9084 {
            address 10.24.69.187
            session user-disabled
            state user-down
        }
        /INPG/10.24.69.187:9985 {
            address 10.24.69.187
            session user-disabled
            state user-down
        }
        /INPG/10.24.69.188:9083 {
            address 10.24.69.188
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI2_MFastPay {
    description "FastPay 驗證"
    members {
        /INPG/10.24.68.101:9950 {
            address 10.24.68.101
        }
        /INPG/10.24.68.102:9950 {
            address 10.24.68.102
        }
        /INPG/10.24.68.103:9950 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9950 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9950 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI2_MICROPAY {
    members {
        /INPG/10.24.68.215:9990 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9991 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9992 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9993 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9990 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9991 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9992 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9993 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI2_PORTAL {
    members {
        /INPG/10.243.136.17:9081 {
            address 10.243.136.17
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.18:9081 {
            address 10.243.136.18
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI2_SERVER {
    members {
        /INPG/10.24.68.207:9085 {
            address 10.24.68.207
        }
        /INPG/10.24.68.208:9085 {
            address 10.24.68.208
        }
        /INPG/10.24.68.215:9085 {
            address 10.24.68.215
        }
        /INPG/10.24.68.216:9085 {
            address 10.24.68.216
        }
        /INPG/10.243.136.17:9085 {
            address 10.243.136.17
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.18:9085 {
            address 10.243.136.18
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI_AP_3DS2 {
    members {
        /INPG/10.24.68.101:9083 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9083 {
            address 10.24.68.102
        }
        /INPG/10.24.68.103:9083 {
            address 10.24.68.103
        }
        /INPG/10.24.68.215:9083 {
            address 10.24.68.215
        }
        /INPG/10.24.68.216:9083 {
            address 10.24.68.216
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI_AP_3DS2_Chinatrust {
    description 3DS2_Chinatrust
    members {
        /INPG/10.24.68.101:9083 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9083 {
            address 10.24.68.102
        }
        /INPG/10.24.68.103:9083 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9083 {
            address 10.24.68.215
        }
        /INPG/10.24.68.216:9083 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MPI_AP_JBOSS {
    description "CTBCBANK 443"
    members {
        /INPG/10.24.68.101:9083 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9083 {
            address 10.24.68.102
        }
        /INPG/10.24.68.103:9083 {
            address 10.24.68.103
        }
        /INPG/10.24.68.215:9083 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9083 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MUPOP {
    members {
        /INPG/10.24.68.101:9987 {
            address 10.24.68.101
        }
        /INPG/10.24.68.102:9987 {
            address 10.24.68.102
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MUPOP_BACKEND {
    members {
        /INPG/10.24.68.101:9988 {
            address 10.24.68.101
        }
        /INPG/10.24.68.102:9988 {
            address 10.24.68.102
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_MicroPOS_AP {
    description "MicroPos Test"
    members {
        /INPG/10.243.136.17:9983 {
            address 10.243.136.17
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.18:9983 {
            address 10.243.136.18
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_NewPos_AP {
    members {
        /INPG/10.24.68.101:9983 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.101:9984 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9983 {
            address 10.24.68.102
        }
        /INPG/10.24.68.102:9984 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9983 {
            address 10.24.68.103
        }
        /INPG/10.24.68.103:9984 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9983 {
            address 10.24.68.207
        }
        /INPG/10.24.68.207:9984 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9985 {
            address 10.24.68.207
        }
        /INPG/10.24.68.207:9986 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9987 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9983 {
            address 10.24.68.208
        }
        /INPG/10.24.68.208:9984 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9985 {
            address 10.24.68.208
        }
        /INPG/10.24.68.208:9986 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9987 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9983 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9984 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9985 {
            address 10.24.68.215
            description TEMP
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9983 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9984 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9985 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.17:9983 {
            address 10.243.136.17
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.18:9983 {
            address 10.243.136.18
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_NewPos_AP_FISC {
    members {
        /INPG/10.24.68.101:9971 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.101:9983 {
            address 10.24.68.101
            monitor /Common/tcp
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9971 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9971 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9983 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9983 {
            address 10.24.68.208
        }
        /INPG/10.24.68.215:9983 {
            address 10.24.68.215
        }
        /INPG/10.24.68.215:9985 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.17:9983 {
            address 10.243.136.17
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.18:9983 {
            address 10.243.136.18
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_NewPos_CCP {
    description "For CCP"
    members {
        /INPG/10.24.68.101:9983 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.101:9984 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9983 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9984 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9983 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9984 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9983 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9984 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9985 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9986 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.207:9987 {
            address 10.24.68.207
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9983 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9984 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9985 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9986 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.208:9987 {
            address 10.24.68.208
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.215:9983 {
            address 10.24.68.215
        }
        /INPG/10.24.68.215:9985 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9983 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9985 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
        /INPG/10.243.136.17:9983 {
            address 10.243.136.17
        }
        /INPG/10.243.136.18:9983 {
            address 10.243.136.18
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_NewQuery_AP {
    members {
        /INPG/10.24.68.101:9981 {
            address 10.24.68.101
        }
        /INPG/10.24.68.102:9981 {
            address 10.24.68.102
        }
        /INPG/10.24.68.103:9981 {
            address 10.24.68.103
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_NewQuery_AP_FISC {
    members {
        /INPG/10.24.68.101:9973 {
            address 10.24.68.101
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.102:9973 {
            address 10.24.68.102
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.103:9973 {
            address 10.24.68.103
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_OneStop_AP {
    description OneStop_AP
    members {
        /INPG/10.24.68.215:9911 {
            address 10.24.68.215
        }
        /INPG/10.24.68.216:9911 {
            address 10.24.68.216
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_PAYPAGE {
    members {
        /INPG/10.24.68.215:9990 {
            address 10.24.68.215
        }
        /INPG/10.24.68.215:9991 {
            address 10.24.68.215
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.216:9990 {
            address 10.24.68.216
        }
        /INPG/10.24.68.216:9991 {
            address 10.24.68.216
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_PG_AP_JBOSS {
    members {
        /INPG/10.24.68.106:8080 {
            address 10.24.68.106
        }
        /INPG/10.24.68.109:8080 {
            address 10.24.68.109
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_PG_AP_JBOSS_AP2 {
    members {
        /INPG/10.24.68.106:8080 {
            address 10.24.68.106
        }
        /INPG/10.24.68.109:8080 {
            address 10.24.68.109
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_ePOS_AP_JBOSS {
    members {
        /INPG/10.23.86.140:9090 {
            address 10.23.86.140
            session user-disabled
            state user-down
        }
        /INPG/10.23.86.142:9090 {
            address 10.23.86.142
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.104:8080 {
            address 10.24.68.104
        }
        /INPG/10.24.68.105:8080 {
            address 10.24.68.105
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.106:8080 {
            address 10.24.68.106
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.107:8080 {
            address 10.24.68.107
        }
        /INPG/10.24.68.108:8080 {
            address 10.24.68.108
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.109:8080 {
            address 10.24.68.109
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_ePOS_AP_JBOSS_AEGW {
    members {
        /INPG/10.24.68.104:9093 {
            address 10.24.68.104
        }
        /INPG/10.24.68.107:9093 {
            address 10.24.68.107
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_ePOS_AP_JBOSS_EZPOS {
    members {
        /INPG/10.24.68.104:8080 {
            address 10.24.68.104
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.107:8080 {
            address 10.24.68.107
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_ePOS_AP_JBOSS_EZPOS2 {
    members {
        /INPG/10.24.68.104:8080 {
            address 10.24.68.104
        }
        /INPG/10.24.68.107:8080 {
            address 10.24.68.107
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL {
    members {
        /INPG/10.24.68.104:9371 {
            address 10.24.68.104
        }
        /INPG/10.24.68.107:9371 {
            address 10.24.68.107
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/POOL_INPG_ePOS_AP_PAYPORTAL {
    description POOL_INPG_ePOS_AP_PAYPORTAL
    members {
        /INPG/10.24.68.104:9371 {
            address 10.24.68.104
        }
        /INPG/10.24.68.107:9093 {
            address 10.24.68.107
            session user-disabled
            state user-down
        }
        /INPG/10.24.68.107:9371 {
            address 10.24.68.107
        }
    }
    monitor /Common/tcp
}
ltm pool /INPG/SPL0075 {
    members {
        /INPG/10.243.136.18:4345 {
            address 10.243.136.18
        }
    }
    monitor /Common/tcp
}
ltm rule /INPG/iRule_Dispatch_INNFI {
when HTTP_REQUEST {
    if { [HTTP::uri] starts_with "/jwpay"}
    {
     pool POOL_INNFI
    }    
    if { [HTTP::uri] starts_with "/jwezpos"}
    {
     pool POOL_INNFI
    }
    if { [HTTP::uri] starts_with "/jwezposLDAP"}
    {
     pool POOL_INNFI
    }
    if { [HTTP::uri] starts_with "/jwinquiry"}
    {
     pool POOL_INNFI
    }
  }
}
ltm rule /INPG/iRule_Dispatch_INNFI_JWPAY {
when RULE_INIT {
  set ::max_connections_innfi 1000
  set ::active_connections_innfi 0
  set ::debug 1
  set ::ma_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
 }
when HTTP_REQUEST {
  if {$::active_connections_innfi > $::max_connections_innfi}{
    HTTP::respond 200 content $::busy_content_innfi
    TCP::close
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_innfi 1    
    if { [HTTP::uri] equals "/jwpay/wechatPayResult.htm"}
    {
     pool POOL_INNFI
    } 
  }
 }

 when CLIENT_CLOSED {
  if {$::active_connections_innfi > 0} {
    incr ::active_connections_innfi -1
  }
 }
 when LB_FAILED {
  HTTP::respond 200 content $::ma_content_innfi
 }
}
ltm rule /INPG/iRule_Dispatch_INNFI_JWPAY_NEW {
when RULE_INIT {
  set ::max_connections_innfi 1000
  set ::active_connections_innfi 0
  set ::debug 1
  set ::ma_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
 }
when HTTP_REQUEST {
  if {$::active_connections_innfi > $::max_connections_innfi}{
    HTTP::respond 200 content $::busy_content_innfi
    TCP::close
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_innfi 1    
    if { [HTTP::uri] contains "newpayment.wechat" }
    {
       pool POOL_INNFI
    }
	if { [HTTP::uri] starts_with "/jwpay"}
    {
       pool POOL_INNFI
    }
    if { [HTTP::uri] starts_with "/jwezpos"}
    {
       pool POOL_INNFI
    }
  }
 }

 when CLIENT_CLOSED {
  if {$::active_connections_innfi > 0} {
    incr ::active_connections_innfi -1
  }
 }
 when LB_FAILED {
  HTTP::respond 200 content $::ma_content_innfi
 }
}
ltm rule /INPG/iRule_Dispatch_INPG_EDC_B24 {
when RULE_INIT {
  set ::max_connections_edc_b24 200
  set ::active_connections_edc_b24 0
}

when CLIENT_ACCEPTED {
 if {$::active_connections_edc_b24 > $::max_connections_edc_b24}{
        reject
 } else {
        incr ::active_connections_edc_b24 1
        #log local0. "CLIENT_ACCEPTED-active connections : $::active_connections_edc_b24"
 }
}

when CLIENT_CLOSED {
    if { $::active_connections_edc_b24 > 0 } {
        incr ::active_connections_edc_b24 -1
        #log local0. "CLIENT_CLOSED-active connections : $::active_connections_edc_b24"
    }
}
}
ltm rule /INPG/iRule_Dispatch_INPG_EDC_CERC {
when RULE_INIT {
  set ::max_connections_edc_cerc 200
  set ::active_connections_edc_cerc 0
}

when CLIENT_ACCEPTED {
 if {$::active_connections_edc_cerc > $::max_connections_edc_cerc}{
        reject
 } else {
        incr ::active_connections_edc_cerc 1
        #log local0. "CLIENT_ACCEPTED-active connections : $::active_connections_edc_cerc"
 }
}

when CLIENT_CLOSED {
    if { $::active_connections_edc_cerc > 0 } {
        incr ::active_connections_edc_cerc -1
        #log local0. "CLIENT_CLOSED-active connections : $::active_connections_edc_cerc"
    }
}
}
ltm rule /INPG/iRule_Dispatch_INPG_EDC_TMS_8900 {
when RULE_INIT {
  set ::max_connections_edc_t8900 200
  set ::active_connections_edc_t8900 0
}

when CLIENT_ACCEPTED {
 if {$::active_connections_edc_t8900 > $::max_connections_edc_t8900}{
        reject
 } else {
        incr ::active_connections_edc_t8900 1
        #log local0. "CLIENT_ACCEPTED-active connections : $::active_connections_edc_t8900"
 }
}

when CLIENT_CLOSED {
    if { $::active_connections_edc_t8900 > 0 } {
        incr ::active_connections_edc_t8900 -1
        #log local0. "CLIENT_CLOSED-active connections : $::active_connections_edc_t8900"
    }
}
}
ltm rule /INPG/iRule_Dispatch_INPG_EDC_TMS_8910 {
when RULE_INIT {
  set ::max_connections_edc_t8910 200
  set ::active_connections_edc_t8910 0
}

when CLIENT_ACCEPTED {
 if {$::active_connections_edc_t8910 > $::max_connections_edc_t8910}{
        reject
 } else {
        incr ::active_connections_edc_t8910 1
        #log local0. "CLIENT_ACCEPTED-active connections : $::active_connections_edc_t8910"
 }
}

when CLIENT_CLOSED {
    if { $::active_connections_edc_t8910 > 0 } {
        incr ::active_connections_edc_t8910 -1
        #log local0. "CLIENT_CLOSED-active connections : $::active_connections_edc_t8910"
    }
}
}
ltm rule /INPG/iRule_Dispatch_INPG_EDC_TMS_8913 {
when RULE_INIT {
  set ::max_connections_edc_t8913 200
  set ::active_connections_edc_t8913 0
}

when CLIENT_ACCEPTED {
 if {$::active_connections_edc_t8913 > $::max_connections_edc_t8913}{
        reject
 } else {
        incr ::active_connections_edc_t8913 1
        #log local0. "CLIENT_ACCEPTED-active connections : $::active_connections_edc_t8913"
 }
}

when CLIENT_CLOSED {
    if { $::active_connections_edc_t8913 > 0 } {
        incr ::active_connections_edc_t8913 -1
        #log local0. "CLIENT_CLOSED-active connections : $::active_connections_edc_t8913"
    }
}
}
ltm rule /INPG/iRule_Dispatch_INPG_MPI {
when RULE_INIT {
	set static::ma_content_mpi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#20449;&#29992;&#21345;3D&#39511;&#35657;&#26381;&#21209; &#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
	set ::3ds2_service 0
	}

when HTTP_REQUEST {
	set ::3ds2_service 0
    # save hostname for use in response
    set fqdn_name [HTTP::host]
    # set X-Forwarded for SSL using F5 Load Balancer
    if {!( [HTTP::header "X-Forwarded-Proto"] eq "https") }{
        HTTP::header insert X-Forwarded-Proto "https"
        HTTP::header insert "HTTPS" "on"
    }
    if { !( [HTTP::header exists "X-Forwarded-Port"]) }{
        HTTP::header insert X-Forwarded-Port [TCP::local_port]
    }
	if { [HTTP::uri] starts_with "/3ds-gateway"} {
		set ::3ds2_service 1
		pool POOL_INPG_MPI2_GW
		persist cookie            
	}elseif { [HTTP::uri] starts_with "/mpisite"} {
		set ::3ds2_service 1
		HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
		persist cookie            
	}elseif { [HTTP::uri] starts_with "/"}
	{
		#pool POOL_INPG_MPI_AP
		#MPISite JBOSS EAP&#23565;&#22806;
		#pool POOL_INPG_MPI_AP_JBOSS
		pool POOL_INPG_MPI_AP_3DS2
		persist cookie
		#log local0. "[HTTP::uri] [HTTP::header X-Forwarded-Proto] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
	} 
}

when HTTP_RESPONSE {
    if { [HTTP::is_redirect] } {
        if { [HTTP::header Location] starts_with "/" }{
            HTTP::header replace Location "https://$fqdn_name[HTTP::header Location]"
        } else {
            HTTP::header replace Location "[string map {"http://" "https://"} [HTTP::header Location]]"
        }
    }
	HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
	if { $::3ds2_service == 0} {
		#HTTP::header insert "X-FRAME-OPTIONS" "DENY"
	}

	set allcookie [HTTP::header values "Set-Cookie"]
	HTTP::header remove "Set-Cookie"
	foreach thecookie $allcookie {
	    if {$thecookie starts_with "MYSESSION"} {
            HTTP::header insert "Set-Cookie" "${thecookie};SameSite=None; secure; HttpOnly;"
        } else {
            HTTP::header insert "Set-Cookie" "$thecookie;SameSite=None; secure; HttpOnly;"
        }
    }
    HTTP::header remove "Content-Security-Policy"

    HTTP::header insert "X-XSS-Protection" "1; mode=block"
	HTTP::header insert "Strict-Transport-Security" "max-age=31536000;includeSubdomains;preload"  
	HTTP::header insert "X-Content-Type-Options" "nosniff"
	HTTP::header insert "Content-Security-Policy" "default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src * data: blob:; style-src * 'unsafe-inline'"
	HTTP::header insert "Referrer-Policy" "strict-origin-when-cross-origin"
	#HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=()"
	HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=(),camera=()"
	HTTP::header insert "Cache-Control" "no-cache, no-store, must-revalidate, max-age=0"
    HTTP::header insert "Cache-Control" "post-check=0, pre-check=0"
    HTTP::header insert "Pragma" "no-cache"
    HTTP::header insert "Expires" "0"

	if { ([HTTP::status] starts_with "4") || ([HTTP::status] starts_with "5")} {
		#HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
	}
}

when LB_FAILED {
	HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
}
}
ltm rule /INPG/iRule_Dispatch_INPG_MPI2 {
when RULE_INIT {
	set static::ma_content_mpi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#20449;&#29992;&#21345;3D&#39511;&#35657;&#26381;&#21209; &#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
	set ::3ds2_service 0
}

when HTTP_REQUEST {
	set ::3ds2_service 0
    # save hostname for use in response
    set fqdn_name [HTTP::host]
    # set X-Forwarded for SSL using F5 Load Balancer
    if {!( [HTTP::header "X-Forwarded-Proto"] eq "https") }{
        HTTP::header insert X-Forwarded-Proto "https"
        HTTP::header insert "HTTPS" "on"
    }
    if { !( [HTTP::header exists "X-Forwarded-Port"]) }{
        HTTP::header insert X-Forwarded-Port [TCP::local_port]
    }
	if { [HTTP::uri] starts_with "/3ds-gateway"} {
		set ::3ds2_service 1
		pool POOL_INPG_MPI2_GW
		persist cookie            
	} 
	elseif { [HTTP::uri] starts_with "/mpisite"} {
		set ::3ds2_service 1
		HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
		persist cookie            
	}elseif { [HTTP::uri] starts_with "/"}
	{
		#pool POOL_INPG_MPI_AP
		# MPISite JBOSS EAP&#23565;&#22806;
		# pool POOL_INPG_MPI_AP_JBOSS
		pool POOL_INPG_MPI_AP_3DS2
		persist cookie
		#log local0. "[HTTP::uri] [HTTP::header X-Forwarded-Proto] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
	} 
}

when HTTP_RESPONSE {
    if { [HTTP::is_redirect] } {
        if { [HTTP::header Location] starts_with "/" }{
            HTTP::header replace Location "https://$fqdn_name[HTTP::header Location]"
        } else {
            HTTP::header replace Location "[string map {"http://" "https://"} [HTTP::header Location]]"
        }
    }
	HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
	if { $::3ds2_service == 0} {
		#HTTP::header insert "X-FRAME-OPTIONS" "DENY"
	}

	set allcookie [HTTP::header values "Set-Cookie"]
	HTTP::header remove "Set-Cookie"
	foreach thecookie $allcookie {
	    if {$thecookie starts_with "MYSESSION"} {
            HTTP::header insert "Set-Cookie" "${thecookie};SameSite=None; secure; HttpOnly;"
        } else {
            HTTP::header insert "Set-Cookie" "$thecookie;SameSite=None; secure; HttpOnly;"
        }
    }
    HTTP::header remove "Content-Security-Policy"

    HTTP::header insert "X-XSS-Protection" "1; mode=block"
	HTTP::header insert "Strict-Transport-Security" "max-age=31536000;includeSubdomains;preload"  
	HTTP::header insert "X-Content-Type-Options" "nosniff"
	HTTP::header insert "Content-Security-Policy" "default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src * data: blob:; style-src * 'unsafe-inline'"
	HTTP::header insert "Referrer-Policy" "strict-origin-when-cross-origin"
	#HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=()"
	HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=(),camera=()"
	HTTP::header insert "Cache-Control" "no-cache, no-store, must-revalidate, max-age=0"
    HTTP::header insert "Cache-Control" "post-check=0, pre-check=0"
    HTTP::header insert "Pragma" "no-cache"
    HTTP::header insert "Expires" "0"

	if { ([HTTP::status] starts_with "4") || ([HTTP::status] starts_with "5")} {
		HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
	}
}

when LB_FAILED {
	HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
}
}
ltm rule /INPG/iRule_Dispatch_INPG_MPI_Chinatrust {
when RULE_INIT {
 set static::ma_content_mpi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#20449;&#29992;&#21345;3D&#39511;&#35657;&#26381;&#21209; &#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
set ::3ds2_service 0
}

when HTTP_REQUEST {
set ::3ds2_service 0
    # save hostname for use in response
    set fqdn_name [HTTP::host]
    # set X-Forwarded for SSL using F5 Load Balancer
    if {!( [HTTP::header "X-Forwarded-Proto"] eq "https") }{
        HTTP::header insert X-Forwarded-Proto "https"
        HTTP::header insert "HTTPS" "on"
    }
    if { !( [HTTP::header exists "X-Forwarded-Port"]) }{
        HTTP::header insert X-Forwarded-Port [TCP::local_port]
    }
 if { [HTTP::uri] starts_with "/3ds-gateway"} {
 set ::3ds2_service 1
  pool POOL_INPG_MPI2_GW
  persist cookie            
}elseif { [HTTP::uri] starts_with "/mpisite"} {
 set ::3ds2_service 1
  HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
  persist cookie            
}elseif { [HTTP::uri] starts_with "/"}
 {
    # pool POOL_INPG_MPI_AP
    # MPISite JBOSS EAP&#23565;&#22806;
    # pool POOL_INPG_MPI_AP_JBOSS
    pool POOL_INPG_MPI_AP_3DS2_Chinatrust
    #pool POOL_INPG_MPI_AP_3DS2
    persist cookie
  #log local0. "[HTTP::uri] [HTTP::header X-Forwarded-Proto] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
 } 
}

when HTTP_RESPONSE {
    if { [HTTP::is_redirect] } {
        if { [HTTP::header Location] starts_with "/" }{
            HTTP::header replace Location "https://$fqdn_name[HTTP::header Location]"
        } else {
            HTTP::header replace Location "[string map {"http://" "https://"} [HTTP::header Location]]"
        }
    }
    HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
    if { $::3ds2_service == 0} {
        #HTTP::header insert "X-FRAME-OPTIONS" "DENY"
    }

    set allcookie [HTTP::header values "Set-Cookie"]
    HTTP::header remove "Set-Cookie"
    foreach thecookie $allcookie {
      if {$thecookie starts_with "MYSESSION"} {
            HTTP::header insert "Set-Cookie" "${thecookie};SameSite=None; secure; HttpOnly;"
        } else {
            HTTP::header insert "Set-Cookie" "$thecookie;SameSite=None; secure; HttpOnly;"
        }
    }
    HTTP::header remove "Content-Security-Policy"

    HTTP::header insert "X-XSS-Protection" "1; mode=block"
    HTTP::header insert "Strict-Transport-Security" "max-age=31536000;includeSubdomains;preload"  
    HTTP::header insert "X-Content-Type-Options" "nosniff"
    HTTP::header insert "Content-Security-Policy" "default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src * data: blob:; style-src * 'unsafe-inline'"
    HTTP::header remove "Referrer-Policy"
    HTTP::header insert "Referrer-Policy" "strict-origin-when-cross-origin"
    HTTP::header remove "Permissions-Policy"
    #HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=()"
    HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=(),camera=()"
    HTTP::header insert "Cache-Control" "no-cache, no-store, must-revalidate, max-age=0"
    HTTP::header insert "Cache-Control" "post-check=0, pre-check=0"
    HTTP::header insert "Pragma" "no-cache"
    HTTP::header insert "Expires" "0"
}

when LB_FAILED {
 HTTP::respond 200 content $::ma_content_mpi Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
}
}
ltm rule /INPG/iRule_Dispatch_INPG_PG {
when RULE_INIT {
 set static::ma_content_pg "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#37504;&#34892;&#31649;&#29702;&#31995;&#32113; &#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
}

when HTTP_REQUEST {
    # save hostname for use in response
    set fqdn_name [HTTP::host]
    # set X-Forwarded for SSL using F5 Load Balancer
    if { [SSL::mode] == 1 } {
        if {!( [HTTP::header "X-Forwarded-Proto"] eq "https") }{
            HTTP::header insert X-Forwarded-Proto "https"
            HTTP::header insert "HTTPS" "on"
        }
        if { !( [HTTP::header exists "X-Forwarded-Port"]) }{
            HTTP::header insert X-Forwarded-Port [TCP::local_port]
        }
    }
 if  { [HTTP::uri] contains "/inquiry2" }
 {
#        pool POOL_INPG_PG_AP2
        # InquiryLDAP JBOSS EAP&#23565;&#22806;
        pool POOL_INPG_PG_AP_JBOSS_AP2
  #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
 }
  elseif  { [HTTP::uri] contains "/ezposldap2" }
 {
#        pool POOL_INPG_PG_AP2
        # EzPosLDAP JBOSS EAP&#23565;&#22806;
        pool POOL_INPG_PG_AP_JBOSS_AP2
  #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"

 } elseif  { [HTTP::uri] starts_with "/3ds-portal"} {
  pool POOL_INPG_MPI2_PORTAL
  persist cookie
}
else {
  #    pool POOL_INPG_PG_AP
    # InquiryLDAP JBOSS EAP&#23565;&#22806;
    pool POOL_INPG_PG_AP_JBOSS
 } 
}
when LB_FAILED {
 HTTP::respond 200 content $static::ma_content_pg
}
when HTTP_RESPONSE {
	if { [HTTP::has_responded] } { return };
    if { [HTTP::is_redirect] } {
        if { [HTTP::header Location] starts_with "/" }{
            HTTP::header replace Location "https://$fqdn_name[HTTP::header Location]"
        } else {
            HTTP::header replace Location "[string map {"http://" "https://"} [HTTP::header Location]]"
        }
    }
}
}
ltm rule /INPG/iRule_Dispatch_INPG_ePOS {
when RULE_INIT {
  set ::max_connections_epos 3000
  set ::active_connections_epos 0
  set ::debug 1
  set ::3ds2_service 0
  set ::remove_x 0
  set ::ma_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#32173;&#35703;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
}
when HTTP_REQUEST {
  set ::3ds2_service 0
  set ::remove_x 0
  if {$::active_connections_epos > $::max_connections_epos}{
    HTTP::respond 200 content $::busy_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
    TCP::close
    if {$::debug}{log local0. "Over limit (current/max: $::active_connections_epos/$::max_connections_epos). Sent response to [IP::client_addr]"}
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_epos 1

        }

		if { [HTTP::has_responded] } { return };
        if {[HTTP::path] contains "/favicon.ico"} {
#     log local0.info "INPG loading favicon.ico"

        } else {

    if  { ([HTTP::uri] starts_with "/auth/TxnServlet") or ([HTTP::uri] starts_with "/auth2/TxnServlet") } {
        HTTP::respond 307 Location "https://epos.ctbcbank.com/mFastPay/TxnServlet"
        if { [HTTP::has_responded] } {return};
    }
    elseif  { ([HTTP::uri] starts_with "/auth2/SSLAuthUI.jsp") } {
        if  { ([HTTP::method] eq "POST") } {  
            HTTP::respond 307 Location "https://epos.ctbcbank.com/mauth/SSLAuthUI.jsp"
            if { [HTTP::has_responded] } {return};
        }else {
            HTTP::redirect "https://epos.ctbcbank.com/mauth/SSLAuthUI.jsp?[HTTP::query]"
            if { [HTTP::has_responded] } {return};
        }
    }
    elseif { [HTTP::uri] starts_with "/ezpos2" }
    {
       #pool POOL_INPG_ePOS_AP2
       # EzPos(PG6) Frontend
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS2
        persist cookie
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ezpos"
    }
    elseif  { ([HTTP::uri] starts_with "/NewPos/InquiryCCPRedeemPoint") or ([HTTP::uri] starts_with "/NewPos/v2/CCPInquiry") } 
    {
        pool POOL_INPG_NewPos_CCP
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/NewPos"}
    {
       pool POOL_INPG_NewPos_AP
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_NewPos"
                persist cookie
    }
    elseif { [HTTP::uri] starts_with "/NewQuery" }
    {
       pool POOL_INPG_NewQuery_AP
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_NewQuery"
                persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mauth" } {
        set ::remove_x 0
        pool POOL_INPG_MICROPAY_AP
        #log local0.info "inpg micropaypage new >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for micropaypage"
        persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mcloud"} {
        set ::remove_x 0
        pool POOL_INPG_MCLOUD
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/mFastPay" } {
        set ::remove_x 0
        pool POOL_INPG_MFastPay
		    persist cookie
        #log local0.info "inpg mFastPay  >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ mFastPay "
    }
        elseif  { ([HTTP::uri] starts_with "/UPOPBackend2") or ([HTTP::uri] starts_with "/UPOPBackend") } {
         if { ([IP::addr [IP::client_addr] equals "172.25.12.65"]) or ([IP::addr [IP::client_addr] equals "172.25.12.66"]) or ([IP::addr [IP::client_addr] equals "172.25.12.67"]) } {
            pool POOL_INPG_MUPOP_BACKEND
            persist cookie
         }
        } elseif { ([HTTP::uri] starts_with "/UPOP2") or ([HTTP::uri] starts_with "/UPOP") } {
        pool POOL_INPG_MUPOP
        persist cookie
    } elseif { [HTTP::uri] starts_with "/Parking_FE" } {
        #&#37325;&#26032;&#23566;&#21521;CAIP&#30340;3scale URL(&#29983;&#25928;&#36611;&#24555;)
		HTTP::header replace Host "caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com:80"

		#&#21152;&#20837;App ID & APP Key &#19988;&#29992;Base64&#21152;&#23494;
		HTTP::header insert Authorization "Basic NmVkZDJkMjQ6YzFiMjM0ZTE2ZWNhYTk3ZDdkNjk0MWNmYmY0NDExNDY="
		#&#36681;&#25563;Content
		HTTP::header remove Content-Type
		HTTP::header insert Content-Type "application/json"

		#&#23559;/Parking_FE/&#23565;&#25033;&#21040;CAIP&#30340;/ppgForward/
		HTTP::uri [string map {"/Parking_FE/dispatchparking" "/ppgForward/"} [HTTP::uri]]
		HTTP::uri [string map {"/Parking_FE/DispatchParking" "/ppgForward/"} [HTTP::uri]]

		HTTP::header insert "api_txno" CAIP[clock format [clock seconds] -format %Y%m%d%H%M%S][format "%014x" [expr { int(100000000000000 * rand()) }]]

		#&#22871;&#29992;INPG&#23560;&#26696;&#23565;&#25033;&#30340; SNAT POOL
		snatpool SNAT_INPG_Intra_epos

		#&#20351;&#29992;&#26032;&#35373;&#23450;&#30340;Pool
		pool POOL_CAIP_Parking_AP
		# Parking Frontend
		#pool POOL_INPG_ePOS_AP_JBOSS
		#persist cookie
    } elseif { [HTTP::uri] starts_with "/payportal" } {
        # WebATM/SmartPay
        pool POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL
        persist cookie
    } elseif { [HTTP::uri] starts_with "/common" } {
        # WebATM/SmartPay ActiveX
        pool POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL
        persist cookie
    } elseif { [HTTP::uri] starts_with "/maegw" } {
        # Parking AMEX Gateway
        pool POOL_INPG_MAEGW
        persist cookie
    } elseif { [HTTP::uri] starts_with "/HubAgentConsole" } {
        # Parking AMEX Gateway
        pool POOL_INPG_ePOS_AP_JBOSS_AEGW
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/authPage" }
    {
        ##pool POOL_INPG_ePOS_AP
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }elseif { [HTTP::uri] starts_with "/auth" }
    {
        pool POOL_INPG_PAYPAGE
        persist cookie
    } elseif  { [HTTP::uri] starts_with "/OneStopWallet"} {
        pool POOL_INPG_OneStop_AP
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/login.jsp" }
    {
        set ::remove_x 2
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }
    elseif { [HTTP::uri] equals "/" }
    {
        set ::remove_x 2
        persist cookie
        HTTP::redirect "https://epos.ctbcbank.com/login.jsp"
		#HTTP::redirect "https://epos.chinatrust.com.tw/login.jsp"
    }
    else 
    {
        ##pool POOL_INPG_ePOS_AP
        set ::remove_x 0
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }}

}

when CLIENT_ACCEPTED {
    if { [IP::addr [IP::client_addr] equals "172.25.12.65"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.12.66"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.12.67"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.65.184"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.65.185"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    }  else {
        SSL::profile INPG_EPOS_SSL_Profile
    }
}

when CLIENT_CLOSED {
  if {$::active_connections_epos > 0} {
    incr ::active_connections_epos -1
  }
}
when LB_FAILED {
  HTTP::respond 200 content $::ma_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
}
when HTTP_RESPONSE {
   HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
  if { $::3ds2_service == 0} {
    #HTTP::header insert "X-FRAME-OPTIONS" "DENY"   
  }

  if { $::remove_x == 1} {
    HTTP::header insert "Special" "EzPos"
  } elseif { $::remove_x == 2} {
    HTTP::header insert "Special" "EzPos2"
  } else {
    HTTP::header remove "Special"
  }

  #For &#21488;&#37941;&#35696;&#38988;
  HTTP::header insert "Access-Control-Allow-Origin" "*"

  set allcookie [HTTP::header values "Set-Cookie"]
  HTTP::header remove "Set-Cookie"
  foreach thecookie $allcookie {
      if {$thecookie starts_with "MYSESSION"} {
         HTTP::header insert "Set-Cookie" "${thecookie}; secure; HttpOnly"
      } else {
         HTTP::header insert "Set-Cookie" "$thecookie; secure; HttpOnly" 
      }
  }

  if { ([HTTP::status] starts_with "4") || ([HTTP::status] starts_with "5")} {
        HTTP::respond 200 content $::busy_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
  }


}
}
ltm rule /INPG/iRule_Dispatch_INPG_ePOS_Chinatrust {
when RULE_INIT {
  set ::max_connections_epos 3000
  set ::active_connections_epos 0
  set ::debug 1
  set ::3ds2_service 0
  set ::ma_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#32173;&#35703;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
}
when HTTP_REQUEST {
  set ::3ds2_service 0
  if {$::active_connections_epos > $::max_connections_epos}{
    HTTP::respond 200 content $::busy_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
    TCP::close
    if {$::debug}{log local0. "Over limit (current/max: $::active_connections_epos/$::max_connections_epos). Sent response to [IP::client_addr]"}
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_epos 1

        }

		if { [HTTP::has_responded] } { return };
        if {[HTTP::path] contains "/favicon.ico"} {
#     log local0.info "INPG loading favicon.ico"

        } else {

    if  { ([HTTP::uri] starts_with "/auth/TxnServlet") or ([HTTP::uri] starts_with "/auth2/TxnServlet") } {
        HTTP::respond 307 Location "https://epos.ctbcbank.com/mFastPay/TxnServlet"
    }
    elseif  { ([HTTP::uri] starts_with "/auth2/SSLAuthUI.jsp") } {
        if  { ([HTTP::method] eq "POST") } {  
            HTTP::respond 307 Location "https://epos.chinatrust.com.tw/mauth/SSLAuthUI.jsp"
        }else {
            HTTP::redirect "https://epos.chinatrust.com.tw/mauth/SSLAuthUI.jsp?[HTTP::query]"
        }
    }
    elseif { [HTTP::uri] starts_with "/ezpos2" }
    {
       #pool POOL_INPG_ePOS_AP2
       # EzPos(PG6) Frontend
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS2
        persist cookie
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ezpos"
    }
    elseif { [HTTP::uri] starts_with "/NewPos"}
    {
       pool POOL_INPG_NewPos_AP
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_NewPos"
                persist cookie
    }
    elseif { [HTTP::uri] starts_with "/NewQuery" }
    {
       pool POOL_INPG_NewQuery_AP
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_NewQuery"
                persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mauth2"} {
        set ::3ds2_service 1
        pool POOL_INPG_MPI2_MICROPAY
        persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mauth" } {
        set ::remove_x 0
        pool POOL_INPG_MICROPAY_AP
        #log local0.info "inpg micropaypage new >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for micropaypage"
        persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mcloud"} {
        set ::remove_x 0
        pool POOL_INPG_MCLOUD
        persist cookie
    }
    elseif  { ([HTTP::uri] starts_with "/mcloud/redirectAuth.do") or ([HTTP::uri] starts_with "/auth/redirectAuth.do")  } {
            HTTP::redirect "https://epos.ctbcbank.com/auth2/redirectAuth.do?[HTTP::query]"    
    }
    elseif { [HTTP::uri] starts_with "/mFastPay" } {
        set ::remove_x 0
        pool POOL_INPG_MFastPay
		    persist cookie
        #log local0.info "inpg mFastPay  >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ mFastPay "
    }
        elseif  { ([HTTP::uri] starts_with "/UPOPBackend2") or ([HTTP::uri] starts_with "/UPOPBackend") } {
         if { ([IP::addr [IP::client_addr] equals "172.25.12.65"]) or ([IP::addr [IP::client_addr] equals "172.25.12.66"]) or ([IP::addr [IP::client_addr] equals "172.25.12.67"]) } {
            pool POOL_INPG_MUPOP_BACKEND
            persist cookie
         }
        } elseif { ([HTTP::uri] starts_with "/UPOP2") or ([HTTP::uri] starts_with "/UPOP") } {
     pool POOL_INPG_MUPOP
     persist cookie
    } elseif { [HTTP::uri] starts_with "/Parking_FE" } {
        #&#37325;&#26032;&#23566;&#21521;CAIP&#30340;3scale URL(&#29983;&#25928;&#36611;&#24555;)
		HTTP::header replace Host "caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com:80"

		#&#21152;&#20837;App ID & APP Key &#19988;&#29992;Base64&#21152;&#23494;
		HTTP::header insert Authorization "Basic NmVkZDJkMjQ6YzFiMjM0ZTE2ZWNhYTk3ZDdkNjk0MWNmYmY0NDExNDY="
		#&#36681;&#25563;Content
		HTTP::header remove Content-Type
		HTTP::header insert Content-Type "application/json"

		#&#23559;/Parking_FE/&#23565;&#25033;&#21040;CAIP&#30340;/ppgForward/
		HTTP::uri [string map {"/Parking_FE/dispatchparking" "/ppgForward/"} [HTTP::uri]]
		HTTP::uri [string map {"/Parking_FE/DispatchParking" "/ppgForward/"} [HTTP::uri]]

		HTTP::header insert "api_txno" CAIP[clock format [clock seconds] -format %Y%m%d%H%M%S][format "%014x" [expr { int(100000000000000 * rand()) }]]

		#&#22871;&#29992;INPG&#23560;&#26696;&#23565;&#25033;&#30340; SNAT POOL
		snatpool SNAT_INPG_Intra_epos

		#&#20351;&#29992;&#26032;&#35373;&#23450;&#30340;Pool
		pool POOL_CAIP_Parking_AP
		# Parking Frontend
		#pool POOL_INPG_ePOS_AP_JBOSS
		#persist cookie
    } elseif { [HTTP::uri] starts_with "/payportal" } {
        # WebATM/SmartPay
        pool POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL
        persist cookie
    } elseif { [HTTP::uri] starts_with "/common" } {
        # WebATM/SmartPay ActiveX
        pool POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL
        persist cookie
    } elseif { [HTTP::uri] starts_with "/HubAgentConsole" } {
        # Parking AMEX Gateway
        pool POOL_INPG_ePOS_AP_JBOSS_AEGW
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/authPage" }
    {
        ##pool POOL_INPG_ePOS_AP
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }elseif { [HTTP::uri] starts_with "/auth" }
    {
        pool POOL_INPG_PAYPAGE
        #pool POOL_INPG_MPI2_MICROPAY
        persist cookie
    } elseif  { [HTTP::uri] starts_with "/OneStopWallet"} {
        pool POOL_INPG_OneStop_AP
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/login.jsp" }
    {
        set ::remove_x 2
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }
    elseif { [HTTP::uri] equals "/" }
    {
        set ::remove_x 1
        persist cookie
        #HTTP::redirect "https://epos.ctbcbank.com/login.jsp"
		HTTP::redirect "https://epos.chinatrust.com.tw/login.jsp"
    }
    else 
    {
        ##pool POOL_INPG_ePOS_AP
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }}

}

when CLIENT_ACCEPTED {
    if { [IP::addr [IP::client_addr] equals "172.25.12.65"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.12.66"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.12.67"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.65.184"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.65.185"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    }  else {
        SSL::profile INPG_EPOS_SSL_Profile
    }
}

when CLIENT_CLOSED {
  if {$::active_connections_epos > 0} {
    incr ::active_connections_epos -1
  }
}
when LB_FAILED {
  HTTP::respond 200 content $::ma_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
}
when HTTP_RESPONSE {
   HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
  if { $::3ds2_service == 0} {
    #HTTP::header insert "X-FRAME-OPTIONS" "DENY"   
  }

  if { $::remove_x == 1} {
    HTTP::header insert "Special" "EzPos"
  } elseif { $::remove_x == 2} {
    HTTP::header insert "Special" "EzPos2"
  } else {
    HTTP::header remove "Special"
  }

  #For &#21488;&#37941;&#35696;&#38988;
  HTTP::header insert "Access-Control-Allow-Origin" "*"

  set allcookie [HTTP::header values "Set-Cookie"]
  HTTP::header remove "Set-Cookie"
  foreach thecookie $allcookie {
      if {$thecookie starts_with "MYSESSION"} {
         HTTP::header insert "Set-Cookie" "${thecookie}; secure; HttpOnly"
      } else {
         HTTP::header insert "Set-Cookie" "$thecookie; secure; HttpOnly" 
      }
  }

  if { ([HTTP::status] starts_with "4") || ([HTTP::status] starts_with "5")} {
        HTTP::respond 200 content $::busy_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
  }


}
}
ltm rule /INPG/iRule_Dispatch_INPG_ePOS_FISC {
when RULE_INIT {
  set ::max_connections_epos 3000
  set ::active_connections_epos 0
  set ::debug 1
  set ::3ds2_service 0
  set ::ma_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#32173;&#35703;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
}
when HTTP_REQUEST {
  set ::3ds2_service 0
  if {$::active_connections_epos > $::max_connections_epos}{
    HTTP::respond 200 content $::busy_content_epos
    TCP::close
    if {$::debug}{log local0. "Over limit (current/max: $::active_connections_epos/$::max_connections_epos). Sent response to [IP::client_addr]"}
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_epos 1

        }

if { [HTTP::has_responded] } { return };
if { [HTTP::uri] starts_with "/micropos"}
{
pool POOL_INPG_NewPos_AP_FISC
persist cookie
}
elseif { [HTTP::uri] starts_with "/microquery" }
{
pool POOL_INPG_NewQuery_AP_FISC
persist cookie
}
else {
HTTP::respond 404
}

}

when CLIENT_ACCEPTED {
  SSL::profile INPG_EPOS_SSL_FISC
}

when CLIENT_CLOSED {
  if {$::active_connections_epos > 0} {
    incr ::active_connections_epos -1
  }
}
when LB_FAILED {
  HTTP::respond 200 content $::ma_content_epos
}
when HTTP_RESPONSE {
   HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
  if { $::3ds2_service == 0} {
  HTTP::header insert "X-FRAME-OPTIONS" "DENY"   
  }
  #For &#21488;&#37941;&#35696;&#38988;
  HTTP::header insert "Access-Control-Allow-Origin" "*"

  set allcookie [HTTP::header values "Set-Cookie"]
  HTTP::header remove "Set-Cookie"
  foreach thecookie $allcookie {
      if {$thecookie starts_with "MYSESSION"} {
         HTTP::header insert "Set-Cookie" "${thecookie}; secure; HttpOnly"
      } else {
         HTTP::header insert "Set-Cookie" "$thecookie;" 
      }
  }

}
}
ltm rule /INPG/iRule_Dispatch_INPG_ePOS_Intra {
when RULE_INIT {
  set ::max_connections_epos 3000
  set ::active_connections_epos 0
  set ::debug 1
  set ::3ds2_service 0
  set ::remove_x 0
  set ::ma_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#32173;&#35703;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_epos "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
}
when HTTP_REQUEST {
  set ::3ds2_service 0
  set ::remove_x 0
  if {$::active_connections_epos > $::max_connections_epos}{
    HTTP::respond 200 content $::busy_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
    TCP::close
    if {$::debug}{log local0. "Over limit (current/max: $::active_connections_epos/$::max_connections_epos). Sent response to [IP::client_addr]"}
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_epos 1

        }

		if { [HTTP::has_responded] } { return };
        if {[HTTP::path] contains "/favicon.ico"} {
#     log local0.info "INPG loading favicon.ico"

        } else {

    if  { ([HTTP::uri] starts_with "/auth/TxnServlet") or ([HTTP::uri] starts_with "/auth2/TxnServlet") } {
        HTTP::respond 307 Location "https://epos.ctbcbank.com/mFastPay/TxnServlet"
    }
    elseif  { ([HTTP::uri] starts_with "/auth2/SSLAuthUI.jsp") } {
        if  { ([HTTP::method] eq "POST") } {  
            HTTP::respond 307 Location "https://epos.ctbcbank.com/mauth/SSLAuthUI.jsp"
        }else {
            HTTP::redirect "https://epos.ctbcbank.com/mauth/SSLAuthUI.jsp?[HTTP::query]"
        }
    }
    elseif { [HTTP::uri] starts_with "/ezpos2" }
    {
       #pool POOL_INPG_ePOS_AP2
       # EzPos(PG6) Frontend
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS2
        set ::remove_x 1
        persist cookie
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ezpos"
    }
    elseif  { [HTTP::uri] starts_with "/NewPosPilot" } {
       pool POOL_INPG_NewPos_AP_FISC
       persist cookie
    }
    elseif { [HTTP::uri] starts_with "/NewPos"}
    {
       #pool POOL_INPG_NewPos_AP
       pool POOL_INPG_NewPos_AP_FISC
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_NewPos"
                persist cookie
    }
    elseif { [HTTP::uri] starts_with "/NewQuery" }
    {
       pool POOL_INPG_NewQuery_AP
       #log local0.info "inpg ezpos2 >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_NewQuery"
                persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/MPos" } {
            pool POOL_INPG_MicroPOS_AP
            persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mauth" } {
        pool POOL_INPG_MICROPAY_AP
        #log local0.info "inpg micropaypage new >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for micropaypage"
        persist cookie
    }
    elseif  { [HTTP::uri] starts_with "/mcloud"} {
        pool POOL_INPG_MCLOUD
        persist cookie
    }
    elseif  { ([HTTP::uri] starts_with "/mcloud/redirectAuth.do") or ([HTTP::uri] starts_with "/auth/redirectAuth.do")  } {
            HTTP::redirect "https://epos.ctbcbank.com/mcloud/redirectAuth.do?[HTTP::query]"    
    }
    elseif { [HTTP::uri] starts_with "/mFastPay" } {
        #pool POOL_INPG_MFastPay
        pool POOL_INPG_MPI2_MFastPay
		    persist cookie
        #log local0.info "inpg mFastPay  >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ mFastPay "
    }
    elseif { [HTTP::uri] starts_with "/AEFastPay" } {
        pool POOL_INPG_MPI2_MFastPay
		    persist cookie
        #log local0.info "inpg mFastPay  >>>[IP::client_addr]:[TCP::client_port]>>>[HTTP::header Host]#[HTTP::uri] for INPG_ mFastPay "
    }
        elseif  { ([HTTP::uri] starts_with "/UPOPBackend2") or ([HTTP::uri] starts_with "/UPOPBackend") } {
         if { ([IP::addr [IP::client_addr] equals "172.25.12.65"]) or ([IP::addr [IP::client_addr] equals "172.25.12.66"]) or ([IP::addr [IP::client_addr] equals "172.25.12.67"]) } {
            pool POOL_INPG_MUPOP_BACKEND
            persist cookie
         }
        } elseif { ([HTTP::uri] starts_with "/UPOP2") or ([HTTP::uri] starts_with "/UPOP") } {
        pool POOL_INPG_MUPOP
        persist cookie
    } elseif { [HTTP::uri] starts_with "/Parking_FE" } {
        #&#37325;&#26032;&#23566;&#21521;CAIP&#30340;3scale URL(&#29983;&#25928;&#36611;&#24555;)
		HTTP::header replace Host "caip-proxy-3scale-apicast-production.apps.scp01.ctbcbank.com:80"

		#&#21152;&#20837;App ID & APP Key &#19988;&#29992;Base64&#21152;&#23494;
		HTTP::header insert Authorization "Basic NmVkZDJkMjQ6YzFiMjM0ZTE2ZWNhYTk3ZDdkNjk0MWNmYmY0NDExNDY="
		#&#36681;&#25563;Content
		HTTP::header remove Content-Type
		HTTP::header insert Content-Type "application/json"

		#&#23559;/Parking_FE/&#23565;&#25033;&#21040;CAIP&#30340;/ppgForward/
		HTTP::uri [string map {"/Parking_FE/dispatchparking" "/ppgForward/"} [HTTP::uri]]
		HTTP::uri [string map {"/Parking_FE/DispatchParking" "/ppgForward/"} [HTTP::uri]]

		HTTP::header insert "api_txno" CAIP[clock format [clock seconds] -format %Y%m%d%H%M%S][format "%014x" [expr { int(100000000000000 * rand()) }]]

		#&#22871;&#29992;INPG&#23560;&#26696;&#23565;&#25033;&#30340; SNAT POOL
		snatpool SNAT_INPG_Intra_epos

		#&#20351;&#29992;&#26032;&#35373;&#23450;&#30340;Pool
		pool POOL_CAIP_Parking_AP
		# Parking Frontend
		#pool POOL_INPG_ePOS_AP_JBOSS
		#persist cookie
    } elseif { [HTTP::uri] starts_with "/payportal" } {
        # WebATM/SmartPay
        #pool POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL
        pool POOL_INPG_ePOS_AP_PAYPORTAL
        persist cookie
    } elseif { [HTTP::uri] starts_with "/common" } {
        # WebATM/SmartPay ActiveX
        pool POOL_INPG_ePOS_AP_JBOSS_PAYPORTAL
        persist cookie
    } elseif { [HTTP::uri] starts_with "/maegw" } {
        # Parking AMEX Gateway
        pool POOL_INPG_MAEGW
        persist cookie
    } 
    elseif { [HTTP::uri] starts_with "/HubAgentConsole" } {
        # Parking AMEX Gateway
        pool POOL_INPG_ePOS_AP_JBOSS_AEGW
        #pool POOL_INPG_MAEGW
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/authPage" }
    {
        ##pool POOL_INPG_ePOS_AP
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }elseif { [HTTP::uri] starts_with "/auth" }
    {
        pool POOL_INPG_PAYPAGE
        persist cookie
    } elseif  { [HTTP::uri] starts_with "/OneStopWallet"} {
        pool POOL_INPG_OneStop_AP
        persist cookie
    }
    elseif { [HTTP::uri] starts_with "/login.jsp" }
    {
        set ::remove_x 2
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        persist cookie
    }
    elseif { [HTTP::uri] equals "/" }
    {
        set ::remove_x 2
        persist cookie
        HTTP::redirect "https://epos.ctbcbank.com/login.jsp"
    }
    else 
    {
        ##pool POOL_INPG_ePOS_AP
        pool POOL_INPG_ePOS_AP_JBOSS_EZPOS
        set ::remove_x 1
        persist cookie
    }}

}

when CLIENT_ACCEPTED {
    if { [IP::addr [IP::client_addr] equals "172.25.12.65"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.12.66"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.12.67"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.65.184"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    } elseif { [IP::addr [IP::client_addr] equals "172.25.65.185"]}
    {
        SSL::profile INPG_EPOS_SSL_Profile_SSLV3
    }  else {
        SSL::profile INPG_EPOS_SSL_Profile
    }
}

when CLIENT_CLOSED {
  if {$::active_connections_epos > 0} {
    incr ::active_connections_epos -1
  }
}

when HTTP_RESPONSE {
   HTTP::header insert "X-FRAME-OPTIONS" "SAMEORIGIN"
  if { $::3ds2_service == 0} {
    #HTTP::header insert "X-FRAME-OPTIONS" "DENY"   
  }

  if { $::remove_x == 1} {
    HTTP::header insert "Special" "EzPos"
  } elseif { $::remove_x == 2} {
    HTTP::header insert "Special" "EzPos2"
  } else {
    HTTP::header remove "Special"
  }

  #For &#21488;&#37941;&#35696;&#38988;
  HTTP::header insert "Access-Control-Allow-Origin" "*"

  set allcookie [HTTP::header values "Set-Cookie"]
  HTTP::header remove "Set-Cookie"
  foreach thecookie $allcookie {
      if {$thecookie starts_with "MYSESSION"} {
         HTTP::header insert "Set-Cookie" "${thecookie}; secure; HttpOnly"
      } else {
         HTTP::header insert "Set-Cookie" "$thecookie; secure; HttpOnly" 
      }
  }

  if { ([HTTP::status] starts_with "4") || ([HTTP::status] starts_with "5")} {
        HTTP::respond 200 content $::busy_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
  }


}

when LB_FAILED {
  HTTP::respond 200 content $::ma_content_epos Content-Type "text/html" X-Frame-Options "SAMEORIGIN" Referrer-Policy "strict-origin-when-cross-origin" X-Content-Type-Options "nosniff" Strict-Transport-Security "max-age=31536000; includeSubdomains; preload" Permissions-Policy "microphone=(),geolocation=(),camera=()" Content-Security-Policy "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';" Cache-Control "no-cache,no-store,must-revalidate,max-age=0,post-check=0,pre-check=0"
}
}
ltm rule /INPG/iRule_INNFI_DISPATCH_AP {
when RULE_INIT {
  set ::max_connections_innfi 1000
  set ::active_connections_innfi 0
  set ::debug 1
  set ::ma_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
 }
when HTTP_REQUEST {
  if {$::active_connections_innfi > $::max_connections_innfi}{
    HTTP::respond 200 content $::busy_content_innfi
    TCP::close
	if { [HTTP::has_responded] } { return };
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_innfi 1    
    if { [HTTP::uri] contains "newpayment.wechat" }
    {
       pool POOL_INNFI_JWPAY
    }
	if { [HTTP::uri] starts_with "/jwpay"}
    {
       pool POOL_INNFI_JWPAY
    }
    # if { [HTTP::uri] starts_with "/jwezpos"}
    # {
    #   pool POOL_INNFI_JWEZPOS
    # }

    # if { [HTTP::uri] equals "/" } {
    #     HTTP::redirect "https://[HTTP::host]/jwezpos/"
    # }

  }
 }

 when CLIENT_CLOSED {
  if {$::active_connections_innfi > 0} {
    incr ::active_connections_innfi -1
  }
 }
 when LB_FAILED {
  HTTP::respond 200 content $::ma_content_innfi
 }
}
ltm rule /INPG/iRule_INNFI_DISPATCH_NOTIFY {
when RULE_INIT {
  set ::max_connections_innfi 1000
  set ::active_connections_innfi 0
  set ::debug 1
  set ::ma_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#27491;&#36914;&#34892;&#31995;&#32113;&#26356;&#26032;&#20013;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
  set ::busy_content_innfi "<html><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><style></style></head><body lang=ZH-TW style='text-justify-trim:punctuation'><p><b><u>&#37325;&#35201;&#20844;&#21578;</u></b></p><p>&#30446;&#21069;&#31995;&#32113;&#32321;&#24537;&#20013;&#65292;&#35531;&#31245;&#20505;&#20877;&#35430;&#65292;&#36896;&#25104;&#19981;&#20415;&#65292;&#25964;&#35531;&#35211;&#35538;!</p><p>&nbsp;</p><p>&#20013;&#22283;&#20449;&#35351; &#25964;&#21855;</p></body></html>"
 }
when HTTP_REQUEST {
  if {$::active_connections_innfi > $::max_connections_innfi}{
    HTTP::respond 200 content $::busy_content_innfi
    TCP::close
	if { [HTTP::has_responded] } { return };
  } elseif {[HTTP::request_num] == 1}{
    incr ::active_connections_innfi 1    
    if { [HTTP::uri] equals "/jwpay/wechatPayResult.htm"}
    {
     pool POOL_INNFI_JWPAY
    } 
  }
 }

 when CLIENT_CLOSED {
  if {$::active_connections_innfi > 0} {
    incr ::active_connections_innfi -1
  }
 }
 when LB_FAILED {
  HTTP::respond 200 content $::ma_content_innfi
 }
}
ltm rule /INPG/iRule_INPG_Cache {
when HTTP_REQUEST {
        if { [HTTP::has_responded] } { return };
       # save hostname for use in response
       set fqdn_name [HTTP::host]
        if { [SSL::mode] == 1 } {
                if {!( [HTTP::header "X-Forwarded-Proto"] eq "https") }{
                        HTTP::header insert X-Forwarded-Proto "https"
                        HTTP::header insert "HTTPS" "on" 
                }
                if { !( [HTTP::header exists "X-Forwarded-Port"]) }{
                        HTTP::header insert X-Forwarded-Port [TCP::local_port]
                }
        }       
}

when HTTP_RESPONSE {
        if { [HTTP::has_responded] } { return };
    HTTP::header remove Server
    foreach header_name [HTTP::header names] {
       if {[string match -nocase X-* $header_name]}{ 
           HTTP::header remove $header_name
       }
       if {[string match -nocase Cache-* $header_name]}{ 
           HTTP::header remove $header_name
       }
       if {[string match -nocase Pragma* $header_name]}{ 
           HTTP::header remove $header_name
       }
       if {[string match -nocase Expires* $header_name]}{ 
           HTTP::header remove $header_name
       }
    }
   if { [HTTP::is_redirect] } {
        if { [HTTP::header Location] starts_with "/" }{
            HTTP::header replace Location "https://$fqdn_name[HTTP::header Location]"
        } else {
            HTTP::header replace Location "[string map {"http://" "https://"} [HTTP::header Location]]"
        }
    }
    HTTP::header remove "Permissions-Policy"
    #HTTP::header remove "Referrer-Policy"

    HTTP::header insert "X-Frame-Options" "SAMEORIGIN"
    HTTP::header insert "Cache-Control" "no-cache, no-store, must-revalidate, max-age=0"
    HTTP::header insert "Cache-Control" "post-check=0, pre-check=0"
    HTTP::header insert "Pragma" "no-cache"
    HTTP::header insert "Expires" "0"
    HTTP::header insert "Strict-Transport-Security" "max-age=31536000;includeSubdomains;preload"  
    #HTTP::header insert "Permissions-Policy" "microphone=(),midi=()"
    HTTP::header insert "Referrer-Policy" "strict-origin-when-cross-origin"
    HTTP::header insert "Permissions-Policy" "microphone=(),geolocation=(),camera=()"
    HTTP::header insert "X-Content-Type-Options" "nosniff"
    HTTP::header insert "Content-Security-Policy" "default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src * data: blob:; style-src * 'unsafe-inline' "


    if { [HTTP::header exists "Special"] }{
        if {[HTTP::header "Special"] eq "EzPos" }{
            HTTP::header remove "Content-Security-Policy"
            HTTP::header insert "Content-Security-Policy" "default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' 'unsafe-inline'; img-src 'self' data: blob: 'unsafe-inline'; style-src 'self' 'unsafe-inline'; frame-ancestors 'self';"
        }

        if {[HTTP::header "Special"] eq "EzPos2" }{
            HTTP::header remove "Content-Security-Policy"
            HTTP::header insert "Content-Security-Policy" "default-src 'self'; script-src 'self';object-src 'none'; frame-ancestors 'self';"
        }
    }




}
}
ltm snat-translation /INPG/10.23.96.82 {
    address 10.23.96.82
    inherited-traffic-group true
    traffic-group /Common/traffic-group-1
}
ltm snat-translation /INPG/10.23.96.83 {
    address 10.23.96.83
    inherited-traffic-group true
    traffic-group /Common/traffic-group-1
}
ltm snat-translation /INPG/10.23.96.90 {
    address 10.23.96.90
    inherited-traffic-group true
    traffic-group /Common/traffic-group-1
}
ltm snat-translation /INPG/10.23.96.91 {
    address 10.23.96.91
    inherited-traffic-group true
    traffic-group /Common/traffic-group-1
}
ltm snat-translation /INPG/10.23.96.97 {
    address 10.23.96.97
    inherited-traffic-group true
    traffic-group /Common/traffic-group-1
}
ltm snatpool /INPG/SNAT_INNFI_intra {
    members {
        /INPG/10.23.96.97
    }
}
ltm snatpool /INPG/SNAT_INPG_Intra_epos {
    members {
        /INPG/10.23.96.82
    }
}
ltm snatpool /INPG/SNAT_INPG_Intra_mpi {
    members {
        /INPG/10.23.96.83
    }
}
ltm snatpool /INPG/SNA_INPG_intra_epos {
    members {
        /INPG/10.23.96.90
    }
}
ltm snatpool /INPG/SNA_INPG_intra_mpi {
    members {
        /INPG/10.23.96.91
    }
}
ltm virtual /INPG/VS_INNFI_443_NFICTBC {
    description 20170811
    destination /Common/175.184.240.184:443
    ip-protocol tcp
    last-modified-time 2023-10-20:18:46:56
    mask 255.255.255.255
    persist {
        /INPG/INNFI_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INNFI_443_NFICTBC { }
    }
    pool /INPG/POOL_INNFI_JWPAY
    profiles {
        /Common/http2 { }
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INNFI_TRANS { }
        /INPG/HTTP_X_forward_HSTS { }
        /INPG/INNFI_SSL_PROFILE {
            context clientside
        }
    }
    rules {
        /INPG/iRule_INNFI_DISPATCH_AP
        /Common/iRule_INNFI_REMOVE_HEADER
        /Common/iRule_INNFI_REMOVE_HEADER_RANGE
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INNFI_intra
        type snat
    }
    translate-address enabled
    translate-port enabled
    vlans {
        /Common/IWEB_Vlan_201
        /Common/IWEB_Vlan_2593
    }
    vlans-enabled
}
ltm virtual /INPG/VS_INNFI_6443_NEW {
    destination /Common/175.184.240.184:6443
    ip-protocol tcp
    last-modified-time 2023-04-14:18:35:14
    mask 255.255.255.255
    persist {
        /INPG/INNFI_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INNFI_6443_NEW { }
    }
    pool /INPG/POOL_INNFI_JWPAY
    profiles {
        /Common/HTTP_X_forward { }
        /Common/http2 { }
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INNFI_NOTIFY { }
        /INPG/INNFI_SSL_PROFILE {
            context clientside
        }
    }
    rules {
        /INPG/iRule_INNFI_DISPATCH_NOTIFY
        /Common/iRule_INNFI_REMOVE_HEADER_RANGE
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INNFI_intra
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_EDC_15050 {
    creation-time 2023-10-06:18:23:39
    destination /INPG/175.184.240.185:15050
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_EDC_CERC_15050
    profiles {
        /Common/fastL4 { }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_EDC_CERC
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_EDC_18900 {
    creation-time 2023-10-06:18:24:03
    destination /INPG/175.184.240.185:18900
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_EDC_TMS_18900
    profiles {
        /Common/fastL4 { }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_EDC_TMS_8900
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_EDC_18910 {
    creation-time 2023-10-06:18:24:25
    destination /INPG/175.184.240.185:18910
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_EDC_TMS_18910
    profiles {
        /Common/fastL4 { }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_EDC_TMS_8910
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_EDC_18913 {
    creation-time 2023-10-06:18:24:44
    destination /INPG/175.184.240.185:18913
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_EDC_TMS_18913
    profiles {
        /Common/fastL4 { }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_EDC_TMS_8913
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_EDC_19010 {
    creation-time 2023-10-06:18:25:13
    destination /INPG/175.184.240.185:19010
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_EDC_B24_19010
    profiles {
        /Common/fastL4 { }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_EDC_B24
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_HYPOS_2011 {
    destination /INPG/10.23.96.82:2011
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_HYPOS_AP
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_HYPOS_2011_CTBC {
    destination /INPG/10.23.96.90:2011
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_HYPOS_AP
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_HYPOS_2011_internet {
    destination /INPG/203.66.181.52:2011
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_HYPOS_AP
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_HYPOS_2011_internet_CTBC {
    destination /INPG/175.184.240.185:2011
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    pool /INPG/POOL_INPG_HYPOS_AP
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_443 {
    destination /INPG/10.23.96.83:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:25:18
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_443 { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI_Chinatrust
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_443_CTBC {
    destination /INPG/10.23.96.91:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:25:34
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_443_CTBC { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_443_internet {
    destination /INPG/203.66.181.53:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:25:46
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_443_internet { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI_Chinatrust
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_443_internet_CTBC {
    destination /INPG/175.184.240.186:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:26:00
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_443_internet_CTBC { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9443 {
    destination /INPG/10.23.96.83:9443
    ip-protocol tcp
    last-modified-time 2024-11-22:17:12:19
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443 { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI_Chinatrust
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9443_CTBC {
    destination /INPG/10.23.96.91:9443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:26:24
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443_CTBC { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI2
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9443_internet {
    destination /INPG/203.66.181.53:9443
    ip-protocol tcp
    last-modified-time 2024-11-22:17:12:52
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443_internet { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI_Chinatrust
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9443_internet_CTBC {
    destination /INPG/175.184.240.186:9443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:26:46
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_MPI_9443_internet_CTBC { }
    }
    pool /INPG/POOL_INPG_MPI_AP_3DS2
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_NMPI_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_MPI2
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9543 {
    creation-time 2023-08-25:18:06:59
    destination /INPG/175.184.240.186:9543
    ip-protocol tcp
    last-modified-time 2023-08-25:20:42:57
    mask 255.255.255.255
    pool /INPG/POOL_INPG_MPI2_SERVER
    profiles {
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_MPI2_AMEX_P {
            context clientside
        }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9643 {
    destination /INPG/175.184.240.186:9643
    ip-protocol tcp
    mask 255.255.255.255
    pool /INPG/POOL_INPG_MPI2_SERVER
    profiles {
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_MPI2_VISA_P {
            context clientside
        }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9743 {
    destination /INPG/175.184.240.186:9743
    ip-protocol tcp
    mask 255.255.255.255
    pool /INPG/POOL_INPG_MPI2_SERVER
    profiles {
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_MPI2_MASTER_P {
            context clientside
        }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9843 {
    destination /INPG/175.184.240.186:9843
    ip-protocol tcp
    mask 255.255.255.255
    pool /INPG/POOL_INPG_MPI2_SERVER
    profiles {
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_MPI2_JCB_P {
            context clientside
        }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_MPI_9943 {
    destination /INPG/175.184.240.186:9943
    ip-protocol tcp
    mask 255.255.255.255
    pool /INPG/POOL_INPG_MPI2_SERVER
    profiles {
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_MPI2_UPOP_P {
            context clientside
        }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_mpi
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_PG_4345 {
    destination /INPG/10.23.96.82:4345
    disabled
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_PG_4345_CTBC {
    destination /INPG/10.23.96.90:4345
    disabled
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_PG_8443 {
    destination /INPG/10.23.96.82:8443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:40:32
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    pool /INPG/POOL_INPG_PG_AP_JBOSS
    profiles {
        /Common/clientssl {
            context clientside
        }
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_PG
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        type automap
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_PG_8443_CTBC {
    destination /INPG/10.23.96.90:8443
    ip-protocol tcp
    last-modified-time 2023-04-14:17:35:49
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_PG_8443_CTBC { }
    }
    pool /INPG/POOL_INPG_PG_AP_JBOSS
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_PG_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_PG
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        type automap
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_443 {
    destination /INPG/10.23.96.82:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:35:43
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443 { }
    }
    pool /INPG/POOL_INPG_ePOS_AP_JBOSS_EZPOS
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_EPOS_SSL_FISC {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_ePOS_Chinatrust
        /INPG/iRule_INPG_Cache
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_443_CTBC {
    destination /INPG/10.23.96.90:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:36:16
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443_CTBC { }
    }
    pool /INPG/POOL_INPG_ePOS_AP_JBOSS_EZPOS
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_EPOS_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_ePOS_Intra
        /INPG/iRule_INPG_Cache
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_443_internet {
    destination /INPG/203.66.181.52:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:36:33
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443_internet { }
    }
    pool /INPG/POOL_INPG_ePOS_AP_JBOSS_EZPOS
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_EPOS_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_ePOS_Chinatrust
        /INPG/iRule_INPG_Cache
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_443_internet_CTBC {
    destination /INPG/175.184.240.185:443
    ip-protocol tcp
    last-modified-time 2022-11-27:04:36:45
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    policies {
        /INPG/asm_auto_l7_policy__VS_INPG_ePOS_443_internet_CTBC { }
    }
    pool /INPG/POOL_INPG_ePOS_AP_JBOSS_EZPOS
    profiles {
        /Common/tcp { }
        /Common/websecurity { }
        /INPG/ASM_SP_INPG { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_EPOS_SSL_Profile {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_ePOS
        /INPG/iRule_INPG_Cache
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_8168 {
    destination /INPG/10.23.96.82:8168
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_8168_CTBC {
    destination /INPG/10.23.96.90:8168
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_8168_internet {
    destination /INPG/203.66.181.52:8168
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNAT_INPG_Intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_8168_internet_CTBC {
    destination /INPG/175.184.240.185:8168
    ip-protocol tcp
    last-modified-time 2024-07-28:01:33:10
    mask 255.255.255.255
    profiles {
        /Common/fastL4 { }
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /INPG/VS_INPG_ePOS_9443_internet_CTBC {
    destination /INPG/175.184.240.185:9443
    ip-protocol tcp
    last-modified-time 2022-11-27:05:03:01
    mask 255.255.255.255
    persist {
        /INPG/INPG_PERSIST {
            default yes
        }
    }
    profiles {
        /Common/tcp { }
        /INPG/HTTP_X_INPG { }
        /INPG/INPG_EPOS_SSL_FISC {
            context clientside
        }
    }
    rules {
        /INPG/iRule_Dispatch_INPG_ePOS_FISC
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /INPG/SNA_INPG_intra_epos
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual-address /INPG/10.23.96.82 {
    address 10.23.96.82
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/10.23.96.83 {
    address 10.23.96.83
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/10.23.96.90 {
    address 10.23.96.90
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/10.23.96.91 {
    address 10.23.96.91
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/175.184.240.185 {
    address 175.184.240.185
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/175.184.240.186 {
    address 175.184.240.186
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/203.66.181.52 {
    address 203.66.181.52
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm virtual-address /INPG/203.66.181.53 {
    address 203.66.181.53
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm cipher group /INPG/Cipher_Group_INPG_EPOS {
    allow {
        /INPG/Cipher_Rule_INPG_EPOS { }
    }
}
ltm cipher rule /INPG/Cipher_Rule_INPG_EPOS {
    cipher ECDHE:!3DES:!SHA1:TLSv1_3
}
ltm monitor http /INPG/INNFI_JWEZPOS_MONITOR {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 30
    ip-dscp 0
    recv OK
    recv-disable none
    send "GET /jwezpos/connect.test HTTP/1.1\r\nHost:10.248.240.23\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5) \r\nConnection:Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /INPG/INNFI_JWPAY_MONITOR {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 30
    ip-dscp 0
    recv OK
    recv-disable none
    send "GET /jwpay/connect.test HTTP/1.1\r\nHost:10.248.240.23\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5) \r\nConnection:Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm persistence cookie /INPG/INNFI_PERSIST {
    always-send disabled
    app-service none
    cookie-name MYSESSION
    defaults-from /Common/cookie
    expiration 0
    httponly disabled
    method insert
    override-connection-limit disabled
    secure disabled
}
ltm persistence cookie /INPG/INPG_PERSIST {
    always-send disabled
    app-service none
    cookie-encryption required
    cookie-encryption-passphrase $M$uH$tLjsWywLuUYahQsWygcDBQ==
    cookie-name MYSESSION
    defaults-from /Common/cookie
    expiration 0
    method insert
    override-connection-limit disabled
    timeout 180
}
ltm profile client-ssl /INPG/INNFI_SSL_PROFILE {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-non-ssl disabled
    app-service none
    cache-size 262144
    cache-timeout 3600
    cert /Common/INNFI_SSL_P_2024
    cert-key-chain {
        INNFI_SSL_P_2024_INNFI_SSL_2024_CHAIN_0 {
            cert /Common/INNFI_SSL_P_2024
            chain /Common/INNFI_SSL_2024_CHAIN
            key /Common/INNFI_SSL_P_2024
        }
    }
    chain /Common/INNFI_SSL_2024_CHAIN
    cipher-group none
    ciphers ECDHE:!3DES:!SHA1:!CHACHA20-POLY1305:!AES:!CAMELLIA
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/INNFI_SSL_P_2024
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation disabled
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_EPOS_SSL_FISC {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-expired-crl disabled
    allow-non-ssl disabled
    app-service none
    authenticate once
    authenticate-depth 9
    ca-file /Common/INPG_EPOS_FISC_2021.crt
    cache-size 262144
    cache-timeout 3600
    cert /Common/epos_ca_2024
    cert-key-chain {
        epos_ca_2024_epos_ca_2024_0 {
            cert /Common/epos_ca_2024
            chain /Common/epos_ca_2024
            key /Common/epos_ca_2024
        }
    }
    chain /Common/epos_ca_2024
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    client-cert-ca none
    crl-file none
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/epos_ca_2024
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    peer-cert-mode require
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation enabled
    retain-certificate false
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_EPOS_SSL_Profile {
    app-service none
    cert /Common/epos_ca_2024
    cert-key-chain {
        epos_ca_2024_epos_ca_2024_0 {
            cert /Common/epos_ca_2024
            chain /Common/epos_ca_2024
            key /Common/epos_ca_2024
        }
    }
    chain /Common/epos_ca_2024
    cipher-group none
    ciphers ECDHE:!3DES:!SHA1:!AES
    defaults-from /Common/clientssl
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/epos_ca_2024
    options { no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    renegotiate-period indefinite
    renegotiate-size 1000mb
    renegotiation enabled
}
ltm profile client-ssl /INPG/INPG_EPOS_SSL_Profile_SSLV3 {
    app-service none
    cert /Common/epos_ca_2024
    cert-key-chain {
        epos_ca_2024_epos_ca_2024_0 {
            cert /Common/epos_ca_2024
            chain /Common/epos_ca_2024
            key /Common/epos_ca_2024
        }
    }
    chain /Common/epos_ca_2024
    cipher-group none
    ciphers DEFAULT:!RC4:SSLv3:!CHACHA20-POLY1305
    defaults-from /INPG/INPG_EPOS_SSL_Profile
    inherit-ca-certkeychain true
    inherit-certkeychain true
    key /Common/epos_ca_2024
    options { dont-insert-empty-fragments no-tlsv1.3 }
    passphrase none
}
ltm profile client-ssl /INPG/INPG_MPI2_AMEX_P {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-non-ssl disabled
    app-service none
    cache-size 262144
    cache-timeout 3600
    cert-key-chain {
        INPG_SSL_3DS2_AE_2023_INPG_SSL_3DS2_AE_2023_0 {
            cert /Common/INPG_SSL_3DS2_AE_2023
            chain /Common/INPG_SSL_3DS2_AE_2023
            key /Common/INPG_SSL_3DS2_AE_2023
        }
    }
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation enabled
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_MPI2_JCB_P {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-non-ssl disabled
    app-service none
    cache-size 262144
    cache-timeout 3600
    cert /Common/INPG_SSL_3DS2_JCB_P_2024
    cert-key-chain {
        INPG_SSL_3DS2_JCB_P_2024_INPG_SSL_3DS2_JCB_P_2024_0 {
            cert /Common/INPG_SSL_3DS2_JCB_P_2024
            chain /Common/INPG_SSL_3DS2_JCB_P_2024
            key /Common/INPG_SSL_3DS2_JCB_P_2024
        }
    }
    chain /Common/INPG_SSL_3DS2_JCB_P_2024
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/INPG_SSL_3DS2_JCB_P_2024
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation enabled
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_MPI2_MASTER_P {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-non-ssl disabled
    app-service none
    cache-size 262144
    cache-timeout 3600
    cert /Common/INPG_SSL_3DS2_MASTER_P_2022.crt
    cert-key-chain {
        INPG_SSL_3DS2_MASTER_P_2022_INPG_SSL_3DS2_MASTER_P_2022 {
            cert /Common/INPG_SSL_3DS2_MASTER_P_2022.crt
            chain /Common/INPG_SSL_3DS2_MASTER_P_2022.crt
            key /Common/INPG_SSL_3DS2_MASTER_P_2022.key
        }
    }
    chain /Common/INPG_SSL_3DS2_MASTER_P_2022.crt
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/INPG_SSL_3DS2_MASTER_P_2022.key
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation enabled
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_MPI2_UPOP_P {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-non-ssl disabled
    app-service none
    cache-size 262144
    cache-timeout 3600
    cert /Common/INPG_MPI2_UPOP_PROD_2022.crt
    cert-key-chain {
        INPG_MPI2_UPOP_PROD_2022_INPG_MPI2_UPOP_PROD_2022 {
            cert /Common/INPG_MPI2_UPOP_PROD_2022.crt
            chain /Common/INPG_MPI2_UPOP_PROD_2022.crt
            key /Common/INPG_MPI2_UPOP_PROD_2022.key
        }
    }
    chain /Common/INPG_MPI2_UPOP_PROD_2022.crt
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/INPG_MPI2_UPOP_PROD_2022.key
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation enabled
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_MPI2_VISA_P {
    alert-timeout 10
    allow-dynamic-record-sizing disabled
    allow-non-ssl disabled
    app-service none
    cache-size 262144
    cache-timeout 3600
    cert /Common/INPG_SSL_3DS2_VISA_2024_2
    cert-key-chain {
        INPG_SSL_3DS2_VISA_2024_2_INPG_SSL_3DS2_VISA_2024_2_0 {
            cert /Common/INPG_SSL_3DS2_VISA_2024_2
            chain /Common/INPG_SSL_3DS2_VISA_2024_2
            key /Common/INPG_SSL_3DS2_VISA_2024_2
        }
    }
    chain /Common/INPG_SSL_3DS2_VISA_2024_2
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/INPG_SSL_3DS2_VISA_2024_2
    max-active-handshakes indefinite
    max-aggregate-renegotiation-per-minute indefinite
    max-renegotiations-per-minute 5
    maximum-record-size 16384
    mod-ssl-methods disabled
    mode enabled
    notify-cert-status-to-virtual-server disabled
    ocsp-stapling disabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    peer-no-renegotiate-timeout 10
    proxy-ssl disabled
    proxy-ssl-passthrough disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size indefinite
    renegotiation enabled
    secure-renegotiation require
    server-name none
    session-mirroring disabled
    session-ticket disabled
    session-ticket-timeout 0
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile client-ssl /INPG/INPG_NMPI_SSL_Profile {
    app-service none
    cert /Common/nmpi_ca_2024
    cert-key-chain {
        nmpi_ca_2024_nmpi_ca_2024_0 {
            cert /Common/nmpi_ca_2024
            chain /Common/nmpi_ca_2024
            key /Common/nmpi_ca_2024
        }
    }
    chain /Common/nmpi_ca_2024
    cipher-group none
    ciphers ECDHE:!3DES:!CHACHA20-POLY1305:!AES
    defaults-from /Common/clientssl
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/nmpi_ca_2024
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    renegotiate-period indefinite
    renegotiate-size 1000mb
    renegotiation enabled
}
ltm profile client-ssl /INPG/INPG_PG_SSL_Profile {
    app-service none
    cert-key-chain {
        INPG_pg_ca_2023_INPG_pg_ca_2023_0 {
            cert /Common/INPG_pg_ca_2023
            chain /Common/INPG_pg_ca_2023
            key /Common/INPG_pg_ca_2023
        }
    }
    cipher-group none
    ciphers DEFAULT:!RC4:!CHACHA20-POLY1305
    defaults-from /Common/clientssl
    inherit-ca-certkeychain true
    inherit-certkeychain false
    options { no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    renegotiate-period indefinite
    renegotiate-size 1000mb
}
ltm profile http /INPG/HTTP_X_INPG {
    app-service none
    defaults-from /Common/http
    encrypt-cookie-secret $M$2a$Ps89/AVCiTDO2KPoG/wWvQ==
    encrypt-cookies { MYSESSION }
    enforcement {
        max-header-count 128
        unknown-method allow
    }
    header-insert "WL-Proxy-SSL: true"
    insert-xforwarded-for enabled
    proxy-type reverse
    redirect-rewrite matching
}
ltm profile http /INPG/HTTP_X_forward_HSTS {
    accept-xff disabled
    app-service none
    defaults-from /Common/http
    encrypt-cookies none
    enforcement {
        known-methods { GET POST }
        max-header-count 128
        max-header-size 32768
        max-requests 0
        pipeline allow
        unknown-method reject
    }
    fallback-host none
    fallback-status-codes none
    header-erase none
    header-insert none
    hsts {
        include-subdomains enabled
        maximum-age 31536000
        mode enabled
        preload disabled
    }
    insert-xforwarded-for enabled
    lws-separator none
    lws-width 80
    oneconnect-transformations enabled
    proxy-type reverse
    redirect-rewrite none
    request-chunking sustain
    response-chunking sustain
    response-headers-permitted none
    via-request preserve
    via-response preserve
    xff-alternative-names none
}
security bot-defense asm-profile /INPG/ASM_Class_INNFI_UAT {
    app-service none
}
security bot-defense asm-profile /INPG/ASM_Class_INPG_Prod {
    app-service none
}
security bot-defense asm-profile /INPG/ASM_SP_INNFI_NOTIFY {
    app-service none
}
security bot-defense asm-profile /INPG/ASM_SP_INNFI_TRANS {
    app-service none
}
security bot-defense asm-profile /INPG/ASM_SP_INPG {
    app-service none
}
sys file ssl-cert /INPG/INNFI_SSL_P_2018.crt {
    cache-path /config/filestore/files_d/INPG_d/certificate_d/:INPG:INNFI_SSL_P_2018.crt_88945_1
    revision 1
}
sys file ssl-key /INPG/INNFI_SSL_P_2018.key {
    cache-path /config/filestore/files_d/INPG_d/certificate_key_d/:INPG:INNFI_SSL_P_2018.key_88942_1
    revision 1
}
