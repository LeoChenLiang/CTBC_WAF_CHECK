#TMSH-VERSION: 17.1.1.3

asm policy /EBMW/SP_EBMW {
    active
    encoding utf-8
}
asm policy /EBMW/SP_EBMWIB_CDN {
    active
    encoding utf-8
}
ltm node /EBMW/10.24.67.28 {
    address 10.24.67.28
}
ltm node /EBMW/10.24.67.29 {
    address 10.24.67.29
}
ltm node /EBMW/10.24.67.30 {
    address 10.24.67.30
}
ltm node /EBMW/10.24.67.31 {
    address 10.24.67.31
    monitor /Common/none
}
ltm node /EBMW/10.24.67.34 {
    address 10.24.67.34
}
ltm node /EBMW/10.24.74.64 {
    address 10.24.74.64
}
ltm node /EBMW/10.24.74.65 {
    address 10.24.74.65
}
ltm node /EBMW/10.24.74.66 {
    address 10.24.74.66
}
ltm node /EBMW/10.24.74.67 {
    address 10.24.74.67
}
ltm node /EBMW/10.24.74.70 {
    address 10.24.74.70
}
ltm node /EBMW/10.24.74.71 {
    address 10.24.74.71
}
ltm node /EBMW/10.24.74.74 {
    address 10.24.74.74
}
ltm node /EBMW/10.24.74.75 {
    address 10.24.74.75
}
ltm node /EBMW/10.24.74.81 {
    address 10.24.74.81
}
ltm node /EBMW/10.24.74.82 {
    address 10.24.74.82
}
ltm node /EBMW/10.24.76.28 {
    address 10.24.76.28
}
ltm node /EBMW/10.24.123.14 {
    address 10.24.123.14
}
ltm node /EBMW/10.24.123.15 {
    address 10.24.123.15
}
ltm node /EBMW/10.24.123.16 {
    address 10.24.123.16
}
ltm node /EBMW/10.24.123.17 {
    address 10.24.123.17
}
ltm node /EBMW/10.24.123.18 {
    address 10.24.123.18
}
ltm node /EBMW/10.24.123.19 {
    address 10.24.123.19
}
ltm node /EBMW/10.24.123.20 {
    address 10.24.123.20
}
ltm node /EBMW/10.24.123.24 {
    address 10.24.123.24
}
ltm node /EBMW/10.24.123.25 {
    address 10.24.123.25
}
ltm node /EBMW/10.248.29.104 {
    address 10.248.29.104
}
ltm node /EBMW/10.248.29.105 {
    address 10.248.29.105
}
ltm node /EBMW/10.248.29.106 {
    address 10.248.29.106
}
ltm node /EBMW/10.248.29.107 {
    address 10.248.29.107
}
ltm node /EBMW/10.248.29.111 {
    address 10.248.29.111
}
ltm node /EBMW/10.248.29.112 {
    address 10.248.29.112
}
ltm node /EBMW/10.248.29.113 {
    address 10.248.29.113
}
ltm node /EBMW/10.248.29.114 {
    address 10.248.29.114
}
ltm node /EBMW/10.248.73.76 {
    address 10.248.73.76
}
ltm node /EBMW/10.248.73.77 {
    address 10.248.73.77
}
ltm node /EBMW/10.248.73.78 {
    address 10.248.73.78
}
ltm node /EBMW/10.248.73.87 {
    address 10.248.73.87
}
ltm node /EBMW/10.248.73.88 {
    address 10.248.73.88
}
ltm node /EBMW/10.248.73.89 {
    address 10.248.73.89
}
ltm node /EBMW/10.248.73.90 {
    address 10.248.73.90
}
ltm node /EBMW/10.248.73.91 {
    address 10.248.73.91
}
ltm node /EBMW/10.248.73.92 {
    address 10.248.73.92
}
ltm node /EBMW/ebmw-mfe-3scale-apicast-production.apps.scp01.ctbcbank.com {
    fqdn {
        address-family all
        name ebmw-mfe-3scale-apicast-production.apps.scp01.ctbcbank.com
    }
}
ltm node /EBMW/ebmw-openapi-3scale-apicast-production.apps.scp01.ctbcbank.com {
    fqdn {
        address-family all
        name ebmw-openapi-3scale-apicast-production.apps.scp01.ctbcbank.com
    }
}
ltm policy /EBMW/asm_auto_l7_policy__VS_EBMWIB_CDN {
    controls { asm }
    requires { http }
    rules {
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /EBMW/SP_EBMWIB_CDN
                }
            }
            ordinal 1
        }
    }
    strategy /Common/first-match
}
ltm policy /EBMW/asm_auto_l7_policy__VS_EBMW_EXT {
    controls { asm }
    requires { http }
    rules {
        Bypass_URL {
            actions {
                0 {
                    asm
                    disable
                }
            }
            conditions {
                0 {
                    http-uri
                    path
                    values { /rb/api/loguploader }
                }
            }
            ordinal 1
        }
        default {
            actions {
                1 {
                    asm
                    enable
                    policy /EBMW/SP_EBMW
                }
            }
            ordinal 2
        }
    }
    strategy /Common/first-match
}
ltm pool /EBMW/POOL_EBMWIB_AP {
    members {
        /EBMW/10.24.74.64:9080 {
            address 10.24.74.64
            monitor /EBMW/HTTP_10_24_74_64
        }
        /EBMW/10.24.74.64:9081 {
            address 10.24.74.64
        }
        /EBMW/10.24.74.65:9080 {
            address 10.24.74.65
        }
        /EBMW/10.24.74.65:9081 {
            address 10.24.74.65
        }
        /EBMW/10.24.74.66:9080 {
            address 10.24.74.66
        }
        /EBMW/10.24.74.66:9081 {
            address 10.24.74.66
        }
        /EBMW/10.24.74.67:9080 {
            address 10.24.74.67
        }
        /EBMW/10.24.74.67:9081 {
            address 10.24.74.67
        }
        /EBMW/10.24.74.81:9080 {
            address 10.24.74.81
            description 10.24.74.81
        }
        /EBMW/10.24.74.81:9081 {
            address 10.24.74.81
            description 10.24.74.81
        }
        /EBMW/10.24.74.82:9080 {
            address 10.24.74.82
            description 10.24.74.82
        }
        /EBMW/10.24.74.82:9081 {
            address 10.24.74.82
            description 10.24.74.82
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMWIB_AP_REDIRECT {
    members {
        /EBMW/10.24.74.64:9090 {
            address 10.24.74.64
        }
        /EBMW/10.24.74.65:9090 {
            address 10.24.74.65
        }
        /EBMW/10.24.74.66:9090 {
            address 10.24.74.66
        }
        /EBMW/10.24.74.67:9090 {
            address 10.24.74.67
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMWIB_Shortener {
    members {
        /EBMW/10.24.74.74:9080 {
            address 10.24.74.74
            monitor /EBMW/HTTP_10_24_74_74
        }
        /EBMW/10.24.74.74:9081 {
            address 10.24.74.74
            monitor /EBMW/HTTP_10_24_74_74
        }
        /EBMW/10.24.74.75:9080 {
            address 10.24.74.75
            monitor /EBMW/HTTP_10_24_74_75
        }
        /EBMW/10.24.74.75:9081 {
            address 10.24.74.75
            monitor /EBMW/HTTP_10_24_74_75
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_AEM_CDN {
    members {
        /EBMW/10.24.123.17:8077 {
            address 10.24.123.17
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.18:8077 {
            address 10.24.123.18
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.19:8077 {
            address 10.24.123.19
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.20:8077 {
            address 10.24.123.20
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.105:8077 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:8077 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8077 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:8077 {
            address 10.248.29.114
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_AEM_CDN_65 {
    members {
        /EBMW/10.248.29.105:8077 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:8077 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8077 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:8077 {
            address 10.248.29.114
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_AP {
    members {
        /EBMW/10.24.67.28:9080 {
            address 10.24.67.28
            monitor /EBMW/HTTP_10_24_67_28
        }
        /EBMW/10.24.67.28:9081 {
            address 10.24.67.28
            monitor /EBMW/HTTP_10_24_67_28
        }
        /EBMW/10.24.67.28:9083 {
            address 10.24.67.28
            monitor /EBMW/HTTP_10_24_67_28
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.28:9084 {
            address 10.24.67.28
            monitor /EBMW/HTTP_10_24_67_28
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.29:9080 {
            address 10.24.67.29
            monitor /EBMW/HTTP_10_24_67_29
        }
        /EBMW/10.24.67.29:9081 {
            address 10.24.67.29
            monitor /EBMW/HTTP_10_24_67_29
        }
        /EBMW/10.24.67.29:9083 {
            address 10.24.67.29
            monitor /EBMW/HTTP_10_24_67_29
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.29:9084 {
            address 10.24.67.29
            monitor /EBMW/HTTP_10_24_67_29
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.30:9080 {
            address 10.24.67.30
            monitor /EBMW/HTTP_10_24_67_30
        }
        /EBMW/10.24.67.30:9081 {
            address 10.24.67.30
            monitor /EBMW/HTTP_10_24_67_30
        }
        /EBMW/10.24.67.30:9083 {
            address 10.24.67.30
            monitor /EBMW/HTTP_10_24_67_30
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.30:9084 {
            address 10.24.67.30
            monitor /EBMW/HTTP_10_24_67_30
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.31:9080 {
            address 10.24.67.31
            monitor /EBMW/HTTP_10_24_67_31
        }
        /EBMW/10.24.67.31:9081 {
            address 10.24.67.31
            monitor /EBMW/HTTP_10_24_67_31
        }
        /EBMW/10.24.67.31:9083 {
            address 10.24.67.31
            monitor /EBMW/HTTP_10_24_67_31
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.31:9084 {
            address 10.24.67.31
            monitor /EBMW/HTTP_10_24_67_31
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.34:9080 {
            address 10.24.67.34
            description "MFP Service Port"
            monitor /EBMW/HTTP_10_24_67_34
            session user-disabled
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_AP_ACCESS_Internal {
    members {
        /EBMW/10.24.74.64:17303 {
            address 10.24.74.64
            monitor /EBMW/HTTP_monitor_ACCESS_64
        }
        /EBMW/10.24.74.65:17303 {
            address 10.24.74.65
            monitor /EBMW/HTTP_monitor_ACCESS_65
        }
        /EBMW/10.24.74.66:17303 {
            address 10.24.74.66
            monitor /EBMW/HTTP_monitor_ACCESS_66
            session user-disabled
            state user-down
        }
        /EBMW/10.24.74.67:17303 {
            address 10.24.74.67
            monitor /EBMW/HTTP_monitor_ACCESS_67
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_AP_ACCESS_extenral {
    members {
        /EBMW/10.24.74.64:17303 {
            address 10.24.74.64
            monitor /EBMW/HTTP_monitor_ACCESS_64
        }
        /EBMW/10.24.74.65:17303 {
            address 10.24.74.65
            monitor /EBMW/HTTP_monitor_ACCESS_65
        }
        /EBMW/10.24.74.66:17303 {
            address 10.24.74.66
            monitor /EBMW/HTTP_monitor_ACCESS_66
            session user-disabled
            state user-down
        }
        /EBMW/10.24.74.67:17303 {
            address 10.24.74.67
            monitor /EBMW/HTTP_monitor_ACCESS_67
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_AP_Internal {
    members {
        /EBMW/10.24.67.28:9080 {
            address 10.24.67.28
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.29:9080 {
            address 10.24.67.29
            session user-disabled
        }
        /EBMW/10.24.67.30:9080 {
            address 10.24.67.30
            session user-disabled
            state user-down
        }
        /EBMW/10.24.67.31:9080 {
            address 10.24.67.31
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_IMP {
    members {
        /EBMW/10.248.73.87:9080 {
            address 10.248.73.87
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.87:9081 {
            address 10.248.73.87
        }
        /EBMW/10.248.73.87:9082 {
            address 10.248.73.87
        }
        /EBMW/10.248.73.87:9083 {
            address 10.248.73.87
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.88:9080 {
            address 10.248.73.88
        }
        /EBMW/10.248.73.88:9081 {
            address 10.248.73.88
        }
        /EBMW/10.248.73.88:9082 {
            address 10.248.73.88
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.88:9083 {
            address 10.248.73.88
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.89:9080 {
            address 10.248.73.89
        }
        /EBMW/10.248.73.89:9081 {
            address 10.248.73.89
        }
        /EBMW/10.248.73.89:9082 {
            address 10.248.73.89
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.89:9083 {
            address 10.248.73.89
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.90:9080 {
            address 10.248.73.90
        }
        /EBMW/10.248.73.90:9081 {
            address 10.248.73.90
        }
        /EBMW/10.248.73.90:9082 {
            address 10.248.73.90
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.90:9083 {
            address 10.248.73.90
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.91:9080 {
            address 10.248.73.91
        }
        /EBMW/10.248.73.91:9081 {
            address 10.248.73.91
        }
        /EBMW/10.248.73.91:9082 {
            address 10.248.73.91
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.91:9083 {
            address 10.248.73.91
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.92:9080 {
            address 10.248.73.92
        }
        /EBMW/10.248.73.92:9081 {
            address 10.248.73.92
        }
        /EBMW/10.248.73.92:9082 {
            address 10.248.73.92
            session user-disabled
            state user-down
        }
        /EBMW/10.248.73.92:9083 {
            address 10.248.73.92
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_OP {
    members {
        /EBMW/10.24.74.70:8080 {
            address 10.24.74.70
        }
        /EBMW/10.24.74.71:8080 {
            address 10.24.74.71
            monitor /Common/http
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.104:8080 {
            address 10.248.29.104
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.107:8080 {
            address 10.248.29.107
            session user-disabled
            state user-down
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_OPENAPI {
    members {
        /EBMW/ebmw-openapi-3scale-apicast-production.apps.scp01.ctbcbank.com:80 {
            fqdn {
                name ebmw-openapi-3scale-apicast-production.apps.scp01.ctbcbank.com
            }
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_TAG {
    members {
        /EBMW/10.248.73.76:8080 {
            address 10.248.73.76
        }
        /EBMW/10.248.73.77:8080 {
            address 10.248.73.77
        }
        /EBMW/10.248.73.78:8080 {
            address 10.248.73.78
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB {
    members {
        /EBMW/10.248.29.105:8080 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.106:8080 {
            address 10.248.29.106
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.111:8080 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8080 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.113:8080 {
            address 10.248.29.113
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.114:8080 {
            address 10.248.29.114
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_65 {
    members {
        /EBMW/10.248.29.105:8080 {
            address 10.248.29.105
            monitor /EBMW/http_ebmw
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.106:8080 {
            address 10.248.29.106
            monitor /EBMW/http_ebmw
        }
        /EBMW/10.248.29.111:8080 {
            address 10.248.29.111
            monitor /EBMW/http_ebmw
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.112:8080 {
            address 10.248.29.112
            monitor /Common/http
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.113:8080 {
            address 10.248.29.113
            monitor /EBMW/http_ebmw
        }
        /EBMW/10.248.29.114:8080 {
            address 10.248.29.114
            monitor /EBMW/http_ebmw
            session user-disabled
            state user-down
        }
    }
    monitor /Common/http
}
ltm pool /EBMW/POOL_EBMW_WEB_COVID {
    members {
        /EBMW/10.24.123.24:8084 {
            address 10.24.123.24
        }
        /EBMW/10.24.123.25:8084 {
            address 10.24.123.25
        }
        /EBMW/10.248.29.106:8084 {
            address 10.248.29.106
            session user-disabled
        }
        /EBMW/10.248.29.113:8084 {
            address 10.248.29.113
            session user-disabled
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_ECOUPON {
    members {
        /EBMW/10.248.29.106:8082 {
            address 10.248.29.106
        }
        /EBMW/10.248.29.113:8082 {
            address 10.248.29.113
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_ECOUPON_65 {
    members {
        /EBMW/10.248.29.106:8082 {
            address 10.248.29.106
        }
        /EBMW/10.248.29.113:8082 {
            address 10.248.29.113
        }
    }
    monitor /EBMW/http_ebmw
}
ltm pool /EBMW/POOL_EBMW_WEB_Insight {
    members {
        /EBMW/10.24.123.17:8088 {
            address 10.24.123.17
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.18:8088 {
            address 10.24.123.18
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.19:8088 {
            address 10.24.123.19
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.20:8088 {
            address 10.24.123.20
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.105:8088 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:8088 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8088 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:8088 {
            address 10.248.29.114
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_Nginx {
    members {
        /EBMW/10.24.123.17:9080 {
            address 10.24.123.17
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.18:9080 {
            address 10.24.123.18
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.19:9080 {
            address 10.24.123.19
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.20:9080 {
            address 10.24.123.20
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.24:9080 {
            address 10.24.123.24
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.25:9080 {
            address 10.24.123.25
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.105:9080 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:9080 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:9080 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:9080 {
            address 10.248.29.114
        }
    }
    monitor /Common/http
}
ltm pool /EBMW/POOL_EBMW_WEB_Nginx_65 {
    members {
        /EBMW/10.248.29.105:9080 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:9080 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:9080 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:9080 {
            address 10.248.29.114
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_ineb {
    members {
        /EBMW/10.24.123.24:8090 {
            address 10.24.123.24
            monitor /EBMW/HTTP_INHK_WEB_24
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.25:8090 {
            address 10.24.123.25
            monitor /EBMW/HTTP_INHK_WEB_25
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.106:8090 {
            address 10.248.29.106
        }
        /EBMW/10.248.29.113:8090 {
            address 10.248.29.113
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_inhk {
    members {
        /EBMW/10.24.123.24:8088 {
            address 10.24.123.24
            monitor /EBMW/HTTP_INHK_WEB_24
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.25:8088 {
            address 10.24.123.25
            monitor /EBMW/HTTP_INHK_WEB_25
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.106:8088 {
            address 10.248.29.106
            monitor /EBMW/HTTP_INHK_WEB_106
        }
        /EBMW/10.248.29.113:8088 {
            address 10.248.29.113
            monitor /EBMW/HTTP_INHK_WEB_113
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_EBMW_WEB_minisite {
    members {
        /EBMW/10.24.123.24:8080 {
            address 10.24.123.24
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.25:8080 {
            address 10.24.123.25
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.106:8080 {
            address 10.248.29.106
        }
        /EBMW/10.248.29.113:8080 {
            address 10.248.29.113
        }
    }
    monitor /Common/http
}
ltm pool /EBMW/POOL_EBMW_WEB_minisite_65 {
    members {
        /EBMW/10.248.29.106:8080 {
            address 10.248.29.106
        }
        /EBMW/10.248.29.113:8080 {
            address 10.248.29.113
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_HKINEB_WEB {
    members {
        /EBMW/10.248.29.106:9580 {
            address 10.248.29.106
        }
        /EBMW/10.248.29.113:9580 {
            address 10.248.29.113
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_INFH_WEB {
    members {
        /EBMW/10.24.123.17:8084 {
            address 10.24.123.17
            monitor /Common/http
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.18:8084 {
            address 10.24.123.18
            monitor /Common/http
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.19:8084 {
            address 10.24.123.19
            monitor /Common/http
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.20:8084 {
            address 10.24.123.20
            monitor /Common/http
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.105:8084 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:8084 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8084 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:8084 {
            address 10.248.29.114
        }
    }
    monitor /Common/tcp
}
ltm pool /EBMW/POOL_INFH_WEB_65 {
    members {
        /EBMW/10.248.29.105:8084 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:8084 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8084 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:8084 {
            address 10.248.29.114
            monitor /EBMW/HTTP_monitor_DIS_17
        }
    }
    monitor /EBMW/http_ebmw
}
ltm pool /EBMW/POOL_LOTTO_WEB {
    members {
        /EBMW/10.24.123.17:8086 {
            address 10.24.123.17
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.18:8086 {
            address 10.24.123.18
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.19:8086 {
            address 10.24.123.19
            session user-disabled
            state user-down
        }
        /EBMW/10.24.123.20:8086 {
            address 10.24.123.20
            session user-disabled
            state user-down
        }
        /EBMW/10.248.29.105:8086 {
            address 10.248.29.105
        }
        /EBMW/10.248.29.111:8086 {
            address 10.248.29.111
        }
        /EBMW/10.248.29.112:8086 {
            address 10.248.29.112
        }
        /EBMW/10.248.29.114:8086 {
            address 10.248.29.114
        }
    }
    monitor /Common/http
}
ltm pool /EBMW/POOL_MFE_AP {
    members {
        /EBMW/ebmw-mfe-3scale-apicast-production.apps.scp01.ctbcbank.com:80 {
            fqdn {
                name ebmw-mfe-3scale-apicast-production.apps.scp01.ctbcbank.com
            }
        }
    }
    monitor /Common/tcp
}
ltm rule /EBMW/iRule_EBMWIB_CDN {
when HTTP_REQUEST {
     if { [HTTP::path] eq "/" }
    {
    HTTP::respond 301 noserver Location "https://www.ctbcbank.com/twrbo/zh_tw/index.html"
    }

    if { ([HTTP::uri] starts_with "/IMP/directupdate/")}
    {
        snatpool SNAT_EBMW
        #HTTP::respond 404
        #node 10.248.73.87 9080
        pool POOL_EBMW_IMP
    }
    else
    {
        snatpool SNAT_EBMW
        rateclass Rate_Class_EBMWIB_100m
        pool POOL_EBMW_AEM_CDN
    }
}
when HTTP_RESPONSE {
    HTTP::header insert Permissions-Policy "microphone=(),midi=()"
    HTTP::header insert Strict-Transport-Security "max-age=31536000; includeSubdomains; preload"
    if { !([ HTTP::header exists "Content-Security-Policy" ])} { 
        HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com *.ctbcbank.com:18080; script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.ctbcbank.com:18080 *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com www.googleadservices.com www.techsolutions.com.tw img.scupio.com jscdn.appier.net bat.bing.com https://tagmanager.google.com https://www.google.com  https://static.line-scdn.net https://api.line.me ; connect-src * https://liffsdk.line-scdn.net https://access.line.me ; style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com *.ctbcbank.com:18080 fonts.googleapis.com https://tagmanager.google.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com tr.line.me *.g.doubleclick.net *.analytics.google.com www.facebook.com *.c.appier.net img.scupio.com bat.bing.com https://ssl.gstatic.com www.google.co.jp www.google.ca www.google.co.th www.google.com.hk www.google.com.vn https://googleads.g.doubleclick.net https://www.google.com g.doubleclick.net https://*.taboola.com https://img.hbhousing.com.tw https://img.great-home.com.tw; frame-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 www.youtube.com www.youtube-nocookie.com www.googletagmanager.com bid.g.doubleclick.net img.scupio.com *.c.appier.net sp.analytics.yahoo.com www.facebook.com ; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 fonts.gstatic.com;"
        #HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com *.ctbcbank.com:18080; script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.ctbcbank.com:18080 *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com www.googleadservices.com www.techsolutions.com.tw img.scupio.com jscdn.appier.net bat.bing.com https://tagmanager.google.com https://www.google.com  ; connect-src * 'unsafe-inline' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://*.g.doubleclick.net *.google.com.tw https://cdn.taboola.com; style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com *.ctbcbank.com:18080 fonts.googleapis.com https://tagmanager.google.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com tr.line.me *.g.doubleclick.net *.analytics.google.com www.facebook.com *.c.appier.net img.scupio.com bat.bing.com https://ssl.gstatic.com www.google.co.jp www.google.ca www.google.co.th www.google.com.hk www.google.com.vn https://googleads.g.doubleclick.net https://www.google.com g.doubleclick.net https://*.taboola.com https://img.hbhousing.com.tw https://img.great-home.com.tw; frame-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 www.youtube.com www.youtube-nocookie.com www.googletagmanager.com bid.g.doubleclick.net img.scupio.com *.c.appier.net sp.analytics.yahoo.com www.facebook.com ; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 fonts.gstatic.com;"
        #HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com *.ctbcbank.com:18080; script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.ctbcbank.com:18080 *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com www.googleadservices.com www.techsolutions.com.tw img.scupio.com jscdn.appier.net s.yimg.com bat.bing.com https://tagmanager.google.com https://www.google.com  ; connect-src * 'unsafe-inline' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://*.g.doubleclick.net *.google.com.tw ; style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com *.ctbcbank.com:18080 fonts.googleapis.com https://tagmanager.google.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com tr.line.me *.g.doubleclick.net *.analytics.google.com www.facebook.com sp.analytics.yahoo.com *.c.appier.net img.scupio.com bat.bing.com https://ssl.gstatic.com www.google.co.jp www.google.ca www.google.co.th www.google.com.hk www.google.com.vn https://googleads.g.doubleclick.net https://www.google.com g.doubleclick.net ; frame-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 www.youtube.com www.youtube-nocookie.com www.googletagmanager.com bid.g.doubleclick.net img.scupio.com *.c.appier.net sp.analytics.yahoo.com www.facebook.com ; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 fonts.gstatic.com;"
#       HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com *.ctbcbank.com:18080;script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com  *.ctbcbank.com:18080 *.google.com *.google.com.tw www.google-analytics.com ssl.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com;connect-src * 'unsafe-inline';style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com *.ctbcbank.com:18080 fonts.googleapis.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.ctbcbank.com:18080 *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com; frame-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 www.youtube.com www.youtube-nocookie.com www.googletagmanager.com; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 fonts.gstatic.com; " 
#       HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com;script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.google.com *.google.com.tw www.google-analytics.com ssl.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com;connect-src * 'unsafe-inline';style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com fonts.googleapis.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com; frame-src 'self' *.ctbcbank.com www.youtube.com www.youtube-nocookie.com www.googletagmanager.com; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com  fonts.gstatic.com; "
#       HTTP::header insert "Content-Security-Policy" "default-src 'self' 'unsafe-inline' 'unsafe-eval' *.ctbcbank.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com ;script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com  *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com https://code.jquery.com  https://cdn.jsdelivr.net https://oss.maxcdn.com;connect-src * 'unsafe-inline';style-src *  'unsafe-inline';img-src * 'unsafe-inline' data: blob: ;frame-src * data: blob: ; frame-ancestors 'self' ;object-src 'none'; "  
#       HTTP::header insert "Content-Security-Policy" "default-src 'self' 'unsafe-inline' 'unsafe-eval' *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com fonts.gstatic.com ;script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com www.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net;connect-src * 'unsafe-inline';style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com fonts.googleapis.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com maps.google.com maps.gstatic.com maps.googleapis.com; frame-src 'self' data: blob: *.ctbcbank.com ; frame-ancestors 'self' ;  object-src 'none'; "  
    }    
    HTTP::header insert Access-Control-Allow-Origin "*"
    HTTP::header insert Referrer-Policy "strict-origin-when-cross-origin"
}
when LB_FAILED {
#HTTP::redirect "https://[HTTP::host]/general/out_of_service.html"
#HTTP::redirect "https://[HTTP::host]/content/dam/ctbc-ib/zh_rb/general/out_of_service.html" 
HTTP::redirect "https://www.ctbcbank.com/content/dam/ctbc-ib/zh_rb/general/out_of_service.html" 
}
}
ltm rule /EBMW/iRule_EBMWOP {
when HTTP_REQUEST {
if { [HTTP::uri] starts_with "/EBMW_OP" }
{
    snatpool SNAT_EBMW
    pool /EBMW/POOL_EBMW_OP
}
else
{
    HTTP::respond 403
}
}
when HTTP_RESPONSE {
 set COOKIE_VAL [HTTP::header values "Set-Cookie"]
 HTTP::header remove "Set-Cookie"

 foreach COOKIE_NAME $COOKIE_VAL {
  HTTP::header insert "Set-Cookie" "${COOKIE_NAME};SameSite=None; Secure"
 }
}
}
ltm rule /EBMW/iRule_EBMW_EXT_Source {
when CLIENTSSL_HANDSHAKE {
  if { [IP::addr [getfield [IP::client_addr] "%" 1] equals 223.137.247.165] } {
    log local0. "[TCP::client_port] :: RSA Session-ID:[SSL::sessionid] Master-Key:[SSL::sessionsecret]"
  }
}
}
ltm rule /EBMW/iRule_EBMW_samesite_cookie_handling {
# iRule: samesite_cookie_handling
# author: Simon Kowallik
# version: 1.3
#
# History: version - author - description
#	 1.0 - Simon Kowallik - initial version 
#	 1.1 - Aaron Hooley - updated to add support for setting SameSite to Strict|Lax|None for BIG-IP and app cookies in Set-Cookie headers
#											- Add option to remove SameSite=None cookies for incompatible browsers
#	 1.2 - Aaron Hooley - Added option to rewrite all cookies without naming them explicitly or with prefixes
#	 1.3 - Aaron Hooley - set samesite_compatible to 0 by default instead of a null string 
#
# What the iRule does:
# Sets SameSite to Strict, Lax or None (and sets Secure when SameSite=None) for compatible user-agents
# Optionally removes SameSite attribute from all cookies for incompatible user-agents so they'll handle cookies as if they were SameSite=None
#
# The iRule should work for:
# - LTM for web app cookies and persistence cookies, except those that the web app sets via Javascript
# - ASM for web app cookies and all ASM cookies except those that ASM or the web app sets via Javascript
# - APM for web app cookies and all APM cookies you configure in the config variable $named_cookies, except those that the web app sets via Javascript
#
# The iRule requires BIG-IP v12 or greater to use the HTTP::cookie attribute command
#
# RFC "standards"
# https://tools.ietf.org/html/draft-west-cookie-incrementalism-00
# https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-05
# further reading:
# https://web.dev/samesite-cookies-explained/
# https://web.dev/samesite-cookie-recipes/
# https://blog.chromium.org/2019/10/developers-get-ready-for-new.html
# https://www.chromium.org/updates/same-site
# https://www.chromium.org/updates/same-site/incompatible-clients

proc checkSameSiteCompatible {user_agent} {
	# Procedure to check if a user-agent supports SameSite=None on cookies
	#
	# usage: 
	#		set isSameSiteCompatible [call checkSameSiteCompatible {User-Agent-String}]
	#
	# check for incompatible user-agents: https://www.chromium.org/updates/same-site/incompatible-clients
	# based on https://devcentral.f5.com/s/articles/HTTP-cookie-SameSite-test-detection-of-browsers-with-incompatible-SameSite-None-handling
	switch -glob -- [set user_agent [string tolower $user_agent]] {
		{*chrome/5[1-9].[0-9]*} -
		{*chrome/6[0-6].[0-9]*} -
		{*chromium/5[1-9].[0-9]*} -
		{*chromium/6[0-6].[0-9]*} -
		{*ip?*; cpu *os 12*applewebkit*} -
		{*macintosh;*mac os x 10_14*version*safari*} -
		{mozilla*macintosh;*mac os x 10_14*applewebkit*khtml, like gecko*} {
			# no samesite support
			return 0
		}
		{*ucbrowser/*} {
			switch -glob -- $user_agent {
				{*ucbrowser/[1-9].*} -
				{*ucbrowser/1[0-1].*} -
				{*ucbrowser/12.[0-9].*} -
				{*ucbrowser/12.1[0-1].*} -
				{*ucbrowser/12.12.*} -
				{*ucbrowser/12.13.[0-2]*} {
					# no samesite support
					return 0
				}
			}
		}
	}
	# If the current user-agent didn't match any known incompatible browser list, assume it can handle SameSite=None 
	return 1

	# CPU Cycles on Executing (>100k test runs)
	#	 Average								 22000-42000 (fastest to slowest path)
	#	 Maximum								214263
	#	 Minimum								 13763
}

# the iRule code
when CLIENT_ACCEPTED priority 100 {

	# Set BIG-IP and app cookies found in Set-Cookie headers using this iRule to:
	#
	# none: Cookies will be sent in both first-party context and cross-origin requests; 
	#		however, the value must be explicitly set to None and all browser requests must 
	#		follow the HTTPS protocol and include the Secure attribute which requires an encrypted 
	#		connection. Cookies that don't adhere to that requirement will be rejected.
	#		Both attributes are required together. If just None is specified without Secure or 
	#		if the HTTPS protocol is not used, the third-party cookie will be rejected.
	#
	# lax: Cookies will be sent automatically only in a first-party context and with HTTP GET requests. 
	#		SameSite cookies will be withheld on cross-site sub-requests, such as calls to load images or iframes, 
	#		but will be sent when a user navigates to the URL from an external site, e.g., by following a link.
	#
	# strict: browser never sends cookies in requests to third party domains
	#
	#		Above definitions from: https://docs.microsoft.com/en-us/microsoftteams/platform/resources/samesite-cookie-update 
	#
	# Note: this iRule does not modify cookies set on the client using Javascript or other methods outside of Set-Cookie headers!
	set samesite_security "none"

	# Uncomment when using this iRule on an APM-enabled virtual server so the MRHSession cookies will be rewritten
	# The iRule cannot be saved on a virtual server with this option uncommented if there is no Access profile also enabled
	#ACCESS::restrict_irule_events disable

	# 1. If you want to set SameSite on all BIG-IP and web application cookies for compliant user-agents, set this option to 1
	# Else, if you want to use the next two options for rewriting explicit named cookies or cookie prefixes, set this option to 0
	set set_samesite_on_all 0

	# 2. Rewrite SameSite on specific named cookies
	#
	# To enable this, list the specific named cookies in the list command and comment out the second set command below
	# To disable this, set this variable to {} and comment out the first set command below
	set named_cookies [list {MRHSession} {LastMRH_Session}]
	#set named_cookies {}

	# 3. Rewrite cookies with a prefix like BIG-IP persistence cookies
	# To enable this, list the cookie name prefixes in the list command and comment out the second set command below
	# To disable this, set this variable to {} and comment out the first set command below
	set cookie_prefixes [list {BIGipServer} {TS}]
	#set cookie_prefixes {}

	# For incompatible user-agents, this iRule can remove the SameSite attribute from all cookies sent to the client via Set-Cookie headers
	# This is only necessary if BIG-IP or the web application being load balanced sets SameSite=None for all clients
	# set to 1 to enable, 0 to disable
	set remove_samesite_for_incompatible_user_agents 1

	# Log debug to /var/log/ltm? 1=yes, 0=no
	# set to 0 after testing
	set samesite_debug 0

	# You shouldn't have to make changes to configuration below here

	# Track the user-agent and whether it supports the SameSite cookie attribute
	set samesite_compatible 0
	set user_agent {}

	if { $samesite_debug }{
		set prefix "[IP::client_addr]:[TCP::client_port]:"
		log local0. "$prefix [string repeat "=" 40]"
		log local0. "$prefix \$samesite_security=$samesite_security; \$set_samesite_on_all=$set_samesite_on_all; \$named_cookies=$named_cookies; \$cookie_prefixes=$cookie_prefixes, \
			\$remove_samesite_for_incompatible_user_agents=$remove_samesite_for_incompatible_user_agents"
	}
}

# Run this test event before any other iRule HTTP_REQUEST events to set the User-Agent header value
# Comment out this event when done testing user-agents
#when HTTP_REQUEST priority 2 {

	# known compatible 
#	HTTP::header replace user-agent {my compatible user agent string}
	# known INcompatible 
#	HTTP::header replace user-agent {chrome/51.10}
#}

# Run this iRule before any other iRule HTTP_REQUEST events
when HTTP_REQUEST priority 100 {

	# If we're setting samesite=none, we need to check the user-agent to see if it's compatible
	if { not [string equal -nocase $samesite_security "none"] }{

		# Not setting SameSite=None, so exit this event
		return
	}

	# Inspect user-agent once per TCP session for higher performance if the user-agent hasn't changed
	if { $samesite_compatible == 0 or $user_agent ne [HTTP::header value {User-Agent}]} {
		set user_agent [HTTP::header value {User-Agent}]
		set samesite_compatible [call checkSameSiteCompatible $user_agent]
		if { $samesite_debug }{
			log local0. "$prefix Got \$samesite_compatible=$samesite_compatible and saved current \$user_agent: $user_agent"
		}
	}
}
# Run this response event with priority 900 after all other iRules to parse the final cookies from the application and BIG-IP
when HTTP_RESPONSE_RELEASE priority 900 {

	# Log the pre-existing Set-Cookie header values
	if { $samesite_debug }{ log local0. "$prefix Set-Cookie value(s): [HTTP::header values {Set-Cookie}]" }

	if { $samesite_compatible } {
		# user-agent is compatible with SameSite=None, set SameSite on matching cookies

		if { $set_samesite_on_all }{
			if { $samesite_debug }{ log local0. "$prefix Setting SameSite=$samesite_security on all cookies and exiting" }
			foreach cookie [HTTP::cookie names] {

				if { $samesite_debug }{ log local0. "$prefix Set SameSite=$samesite_security on $cookie" }

				# Remove any prior instances of SameSite attributes
				HTTP::cookie attribute $cookie remove {samesite} 

				# Insert a new SameSite attribute
				HTTP::cookie attribute $cookie insert {samesite} $samesite_security

				# If samesite attribute is set to None, then the Secure flag must be set for browsers to accept the cookie
				if {[string equal -nocase $samesite_security "none"]} {
					HTTP::cookie secure $cookie enable
				}
			}
			# Exit this event in this iRule as we've already rewritten all cookies with SameSite
			return
		}
		# Match named cookies exactly
		if { $named_cookies ne {} }{
			foreach cookie $named_cookies {
				if { [HTTP::cookie exists $cookie] } {
					# Remove any pre-existing SameSite attributes from this cookie as most clients use the most strict value if multiple instances are set
					HTTP::cookie attribute $cookie remove {SameSite}

					# Insert the SameSite attribute
					HTTP::cookie attribute $cookie insert {SameSite} $samesite_security

					# If samesite attribute is set to None, then the Secure flag must be set for browsers to accept the cookie
					if {[string equal -nocase $samesite_security "none"]} {
						HTTP::cookie secure $cookie enable
					}
				if { $samesite_debug }{ log local0. "$prefix Matched explicitly named cookie $cookie, set SameSite=$samesite_security" }
				if { $samesite_debug }{ log local0. "$prefix " }
				}
			}
		}
		# Match a cookie prefix (cookie name starts with a prefix from the $cookie_prefixes list)
		if { $cookie_prefixes ne {} }{
			foreach cookie [HTTP::cookie names] {
				foreach cookie_prefix $cookie_prefixes {
					if { $cookie starts_with $cookie_prefix } {
						# Remove any pre-existing SameSite attributes from this cookie as most clients use the most strict value if multiple instances are set
						HTTP::cookie attribute $cookie remove {SameSite}

						# Insert the SameSite attribute
						HTTP::cookie attribute $cookie insert {SameSite} $samesite_security

						# If samesite attribute is set to None, then the Secure flag must be set for browsers to accept the cookie
						if { [string equal -nocase $samesite_security "none"] } {
							HTTP::cookie secure $cookie enable
						}
						if { $samesite_debug }{ log local0. "$prefix Matched prefixed cookie $cookie, with prefix $cookie_prefix, set SameSite=$samesite_security, breaking from loop" }
						break
					}
				}
			}
		}
	} else {

		# User-agent can't handle SameSite=None

		if { $remove_samesite_for_incompatible_user_agents }{

			# User-agent can't handle SameSite=None, so remove SameSite attribute from all cookies if SameSite=None
			# This will use CPU cycles on BIG-IP so only enable it if you know BIG-IP or the web application is setting 
			# SameSite=None for all clients including incompatible ones
			foreach cookie [HTTP::cookie names] {
				if { [string tolower [HTTP::cookie attribute $cookie value SameSite]] eq "none" }{
					HTTP::cookie attribute $cookie remove SameSite
					if { $samesite_debug }{ log local0. "$prefix Removing SameSite for incompatible client from cookie=$cookie" }
				}
			}
		}
	}
	# Log the modified Set-Cookie header values
	if { $samesite_debug }{ log local0. "$prefix Final Set-Cookies: [HTTP::header values {Set-Cookie}]" }
}
}
ltm rule /EBMW/iRule_dispatch_EBMW {
when HTTP_REQUEST {
if { [HTTP::uri] starts_with "/RB/api/directupdate" }
{
#rateclass Rate_Class_EBMWIB_600m
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB_Nginx
   #pool POOL_EBMW_WEB
}
elseif { [HTTP::uri] starts_with "/RB/api/loguploader" }
{
    HTTP::respond 201
}
elseif { [HTTP::uri] starts_with "/RB/api" }
{
   HTTP::header insert Client-Port [TCP::client_port]
   snatpool SNAT_EBMW
   pool POOL_EBMW_AP
}
elseif { [HTTP::uri] starts_with "/IMP/" }
{
    HTTP::header insert Client-Port [TCP::client_port]
    if { ([HTTP::uri] starts_with "/IMP/api/adapters/EBMW_Adapter/health")}{
        HTTP::respond 403
    }
    #snatpool SNAT_EBMW
    if { ([HTTP::uri] starts_with "/IMP/directupdate/download/")}
    {
        HTTP::respond 403
        #pool POOL_EBMW_IMP
    }
    else
    {
        snatpool SNAT_EBMW
        pool POOL_EBMW_IMP
    }
}
elseif { [HTTP::uri] starts_with "/webads" }
{
   # &#27298;&#26597;&#26159;&#21542;&#24050;&#32147;&#26377; Cookies
   if { [HTTP::cookie exists "v1st"] } {
       # &#22914;&#26524;&#24050;&#23384;&#22312;&#65292;&#21487;&#20197;&#22312;&#36889;&#35041;&#36914;&#34892;&#30456;&#25033;&#34389;&#29702;
   } else {
       # &#29983;&#25104;&#19968;&#20491;&#38263;&#24230;&#28858; 16 &#30340;&#38568;&#27231;&#23383;&#20018;&#65292;&#21253;&#21547; 0-9 &#21644; A-F
       set characters "123456789ABCDEF"
       set random_value ""
       for {set i 0} {$i < 16} {incr i} {
           append random_value [string index $characters [expr {int(rand() * [string length $characters])}]]
       }
       # &#26032;&#22686;&#21517;&#28858; "v1st" &#30340; Cookies&#65292;&#20540;&#28858;&#38568;&#27231;&#23383;&#20018;
       HTTP::respond 200 "Set-Cookie" "v1st=$random_value; Path=/; Secure; SameSite=None; HttpOnly; expires=Fri, 31 Dec 2123 23:59:59 GMT"
   }
   snatpool SNAT_EBMW
   pool POOL_EBMW_TAG
}
elseif { [HTTP::uri] starts_with "/jscollection" }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB_Insight
}
elseif { ([HTTP::uri] starts_with "/content/ctbc-ib") or ([HTTP::uri] starts_with "/content/dam") }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
}
elseif { ([HTTP::uri] starts_with "/mfe") }
{
   snatpool SNAT_EBMW
   pool POOL_MFE_AP
}
else
{
   HTTP::respond 403
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
}
when HTTP_RESPONSE {
   if { !([ HTTP::header exists "Referrer-Policy" ])} {
      HTTP::header insert "Referrer-Policy" "strict-origin-when-cross-origin"  
    }
   if { !([ HTTP::header exists "Strict-Transport-Security" ])} {
      HTTP::header insert "Strict-Transport-Security" "max-age=31536000; includeSubDomains; preload" 
    }
   if { !([ HTTP::header exists "Permissions-Policy" ])} {
      HTTP::header insert "Permissions-Policy" "microphone=(), midi=()"  
    }
   if { !([ HTTP::header exists "Cache-Control" ])} {
      HTTP::header insert "Cache-Control" "no-store, max-age=0"  
    }
   if { !([ HTTP::header exists "Content-Security-Policy" ])} {
      HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com *.ctbcbank.com:18080; script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.ctbcbank.com:18080 *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com www.googleadservices.com www.techsolutions.com.tw img.scupio.com jscdn.appier.net s.yimg.com bat.bing.com https://tagmanager.google.com https://www.google.com  ; connect-src * 'unsafe-inline' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://*.g.doubleclick.net *.google.com.tw ; style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com *.ctbcbank.com:18080 fonts.googleapis.com https://tagmanager.google.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com tr.line.me *.g.doubleclick.net *.analytics.google.com www.facebook.com sp.analytics.yahoo.com *.c.appier.net img.scupio.com bat.bing.com https://ssl.gstatic.com www.google.co.jp www.google.ca www.google.co.th www.google.com.hk www.google.com.vn https://googleads.g.doubleclick.net https://www.google.com g.doubleclick.net ; frame-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 www.youtube.com www.youtube-nocookie.com www.googletagmanager.com bid.g.doubleclick.net img.scupio.com *.c.appier.net sp.analytics.yahoo.com www.facebook.com ; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 fonts.gstatic.com;"
    }
}
when LB_FAILED {
HTTP::redirect "https://www.ctbcbank.com/content/dam/ctbc-ib/zh_rb/general/out_of_service.html"
}
}
ltm rule /EBMW/iRule_dispatch_EBMWIB_internal {
when HTTP_REQUEST {
if { [string tolower [HTTP::uri]] starts_with "/RB/api/directupdate" }
{
rateclass Rate_Class_EBMW
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { [HTTP::uri] starts_with "/RB/api" }
{
   HTTP::header insert Client-Port [TCP::client_port]
   snatpool SNAT_EBMW
   pool POOL_EBMW_AP_Internal
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { ([HTTP::uri] starts_with "/webads") }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_TAG
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
else
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
}

when LB_FAILED {
HTTP::redirect "https://eb.ctbcbank.com/error.html"
}
}
ltm rule /EBMW/iRule_dispatch_EBMW_Internal {
when HTTP_REQUEST {
if { [HTTP::uri] starts_with "/RB/api/directupdate" }
{
rateclass Rate_Class_EBMW
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
   log "SAMMY_2"
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { [HTTP::uri] starts_with "/RB/api" }
{
   HTTP::header insert Client-Port [TCP::client_port]
   snatpool SNAT_EBMW
   pool POOL_EBMW_AP_Internal
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { ([HTTP::uri] starts_with "/webads") or ([HTTP::uri] starts_with "/jscollection") }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_TAG
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { ([HTTP::uri] starts_with "/content/ctbc-ib") or ([HTTP::uri] starts_with "/content/dam") }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { ([HTTP::uri] starts_with "/mfe") }
{
   snatpool SNAT_EBMW
   pool POOL_MFE_AP
}
else
{
   HTTP::respond 403
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
}
when HTTP_RESPONSE {
   if { !([ HTTP::header exists "Referrer-Policy" ])} {
      HTTP::header insert "Referrer-Policy" "strict-origin-when-cross-origin"  
    }
   if { !([ HTTP::header exists "Strict-Transport-Security" ])} {
      HTTP::header insert "Strict-Transport-Security" "max-age=31536000; includeSubDomains; preload" 
    }
   if { !([ HTTP::header exists "Permissions-Policy" ])} {
      HTTP::header insert "Permissions-Policy" "microphone=(), midi=()"  
    }
   if { !([ HTTP::header exists "Cache-Control" ])} {
      HTTP::header insert "Cache-Control" "no-store, max-age=0"  
    }
   if { !([ HTTP::header exists "Content-Security-Policy" ])} {
      HTTP::header insert "Content-Security-Policy" "default-src 'self' *.ctbcbank.com *.ctbcbank.com:18080; script-src 'unsafe-eval' 'unsafe-inline' *.ctbcbank.com *.ctbcbank.com:18080 *.google.com *.google.com.tw *.google-analytics.com *.googleapis.com *.googletagmanager.com *.gstatic.com googleads.g.doubleclick.net connect.facebook.net d.line-scdn.net www.youtube.com www.googleadservices.com www.techsolutions.com.tw img.scupio.com jscdn.appier.net s.yimg.com bat.bing.com https://tagmanager.google.com https://www.google.com  ; connect-src * 'unsafe-inline' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://*.g.doubleclick.net *.google.com.tw ; style-src 'self' 'unsafe-inline' https://maxcdn.bootstrapcdn.com *.ctbcbank.com *.ctbcbank.com:18080 fonts.googleapis.com https://tagmanager.google.com ;img-src 'self' 'unsafe-inline' data: blob: *.ctbcbank.com *.google.com *.google.com.tw *.google-analytics.com *.googletagmanager.com *.gstatic.com *.googleapis.com tr.line.me *.g.doubleclick.net *.analytics.google.com www.facebook.com sp.analytics.yahoo.com *.c.appier.net img.scupio.com bat.bing.com https://ssl.gstatic.com www.google.co.jp www.google.ca www.google.co.th www.google.com.hk www.google.com.vn https://googleads.g.doubleclick.net https://www.google.com g.doubleclick.net ; frame-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 www.youtube.com www.youtube-nocookie.com www.googletagmanager.com bid.g.doubleclick.net img.scupio.com *.c.appier.net sp.analytics.yahoo.com www.facebook.com ; frame-ancestors 'self' ;  object-src 'none'; font-src 'self' *.ctbcbank.com *.ctbcbank.com:18080 fonts.gstatic.com;"
    }
}
when LB_FAILED {
HTTP::redirect "https://www.ctbcbank.com/content/dam/ctbc-ib/zh_rb/general/out_of_service.html"
}
}
ltm rule /EBMW/iRule_dispatch_EBMW_fix {
when HTTP_REQUEST {
if { [HTTP::uri] starts_with "/RB/api/directupdate" }
{
rateclass Rate_Class_EBMW
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { [HTTP::uri] starts_with "/RB/api" }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_AP
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { ([HTTP::uri] starts_with "/webads") or ([HTTP::uri] starts_with "/jscollection") }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_TAG
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
elseif { ([HTTP::uri] starts_with "/content/ctbc-ib") or ([HTTP::uri] starts_with "/content/dam") }
{
   snatpool SNAT_EBMW
   pool POOL_EBMW_WEB
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
else
{
   HTTP::respond 403
   #log local0. "[HTTP::uri] [HTTP::header Referer] [HTTP::cookie JESSIONID] to server [LB::server addr] port [LB::server port]"
}
}

when LB_FAILED {
HTTP::redirect "https://www.ctbcbank.com/content/dam/ctbc-ib/zh_rb/general/out_of_service.html"
}
}
ltm snat-translation /EBMW/10.23.96.99 {
    address 10.23.96.99
    inherited-traffic-group true
    traffic-group /Common/traffic-group-1
}
ltm snatpool /EBMW/SNAT_EBMW {
    members {
        /EBMW/10.23.96.99
    }
}
ltm virtual /EBMW/VS_EBMWIB_CDN {
    creation-time 2023-03-17:17:43:24
    destination /Common/175.184.240.190:443
    ip-protocol tcp
    last-modified-time 2023-11-03:23:43:59
    mask 255.255.255.255
    persist {
        /Common/source_addr {
            default yes
        }
    }
    policies {
        /EBMW/asm_auto_l7_policy__VS_EBMWIB_CDN { }
    }
    pool /EBMW/POOL_EBMW_AEM_CDN_65
    profiles {
        /Common/EBMW_mkt_Profile {
            context clientside
        }
        /Common/HTTP_X_forward { }
        /Common/tcp { }
        /Common/websecurity { }
        /EBMW/ASM_SP_EBMWIB_CDN { }
    }
    rules {
        /EBMW/iRule_EBMWIB_CDN
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    translate-address enabled
    translate-port enabled
    vlans {
        /Common/IWEB_Vlan_2593
    }
    vlans-enabled
}
ltm virtual /EBMW/VS_EBMWIB_INT {
    destination /Common/10.23.96.99:8443
    ip-protocol tcp
    last-modified-time 2023-05-15:19:50:54
    mask 255.255.255.255
    persist {
        /Common/source_addr {
            default yes
        }
    }
    pool /EBMW/POOL_EBMW_WEB
    profiles {
        /Common/HTTP_X_forward_Response_Unchunk { }
        /Common/http-EBMW-compression { }
        /Common/tcp { }
        /EBMW/EBMW_eb_Profile {
            context clientside
        }
    }
    rules {
        /EBMW/iRule_dispatch_EBMWIB_internal
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /EBMW/SNAT_EBMW
        type snat
    }
    translate-address enabled
    translate-port enabled
    vlans {
        /Common/IWEB_Vlan_2592
    }
}
ltm virtual /EBMW/VS_EBMW_EXT {
    destination /EBMW/175.184.243.188:443
    ip-protocol tcp
    last-modified-time 2023-06-16:17:37:02
    mask 255.255.255.255
    persist {
        /Common/source_addr {
            default yes
        }
    }
    policies {
        /EBMW/asm_auto_l7_policy__VS_EBMW_EXT { }
    }
    pool /EBMW/POOL_EBMW_WEB_65
    profiles {
        /Common/HTTP_X_forward_Response_Unchunk { }
        /Common/http-EBMW-compression { }
        /Common/tcp { }
        /Common/websecurity { }
        /EBMW/ASM_SP_EBMW { }
        /EBMW/EBMW_eb_Profile {
            context clientside
        }
        /EBMW/rewrite-mft { }
    }
    rules {
        /Common/iRule_Dispatch_EBMW_Deny
        /EBMW/iRule_dispatch_EBMW
        /EBMW/iRule_EBMW_samesite_cookie_handling
    }
    security-log-profiles {
        /Common/Arcsight_LOG_P
        /Common/Arcsight_LOG_P_local
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /EBMW/SNAT_EBMW
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /EBMW/VS_EBMW_INT {
    destination /Common/10.23.96.99:443
    ip-protocol tcp
    last-modified-time 2023-06-16:17:35:05
    mask 255.255.255.255
    persist {
        /Common/source_addr {
            default yes
        }
    }
    pool /EBMW/POOL_EBMW_WEB_65
    profiles {
        /Common/HTTP_X_forward_Response_Unchunk { }
        /Common/http-EBMW-compression { }
        /Common/tcp { }
        /EBMW/EBMW_eb_Profile {
            context clientside
        }
        /EBMW/rewrite-mft { }
    }
    rules {
        /EBMW/iRule_dispatch_EBMW_Internal
        /EBMW/iRule_EBMW_samesite_cookie_handling
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /EBMW/SNAT_EBMW
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual /EBMW/VS_EBMW_INT_AP2AP {
    destination /Common/10.23.96.99:80
    ip-protocol tcp
    last-modified-time 2023-06-16:17:37:10
    mask 255.255.255.255
    persist {
        /Common/source_addr {
            default yes
        }
    }
    pool /EBMW/POOL_EBMW_WEB_65
    profiles {
        /Common/HTTP_X_forward_Response_Unchunk { }
        /Common/tcp { }
    }
    rules {
        /EBMW/iRule_dispatch_EBMWIB_internal
    }
    serverssl-use-sni disabled
    source 0.0.0.0/0
    source-address-translation {
        pool /EBMW/SNAT_EBMW
        type snat
    }
    translate-address enabled
    translate-port enabled
}
ltm virtual-address /EBMW/175.184.243.188 {
    address 175.184.243.188
    arp enabled
    icmp-echo enabled
    mask 255.255.255.255
    traffic-group /Common/traffic-group-1
}
ltm monitor http /EBMW/HTTP_10_24_67_28 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /RB/api/adapters/EBMW_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.67.28\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_67_29 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /RB/api/adapters/EBMW_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.67.29\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_67_30 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /RB/api/adapters/EBMW_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.67.30\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_67_31 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /RB/api/adapters/EBMW_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.67.31\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_67_33 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /RB/api/adapters/EBMW_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.67.33\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_67_34 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /RB/api/adapters/EBMW_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.67.34\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_74_64 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /IB/api/adapters/IB_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.74.64\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_74_74 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /Ext/api/adapters/Ext_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.74.74\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_10_24_74_75 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /Ext/api/adapters/Ext_Adapter/resource/ping HTTP/1.1\r\nHost:10.24.74.75\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_INHK_WEB_24 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /notfound.html HTTP/1.1\r\nHost:10.24.123.24 \r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_INHK_WEB_25 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /notfound.html HTTP/1.1\r\nHost:10.24.123.24 \r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_INHK_WEB_106 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /notfound.html HTTP/1.1\r\nHost:10.248.29.106 \r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_INHK_WEB_113 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /notfound.html HTTP/1.1\r\nHost:10.248.29.113 \r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_monitor_ACCESS_64 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /INEBAccessibleWeb/resources/html/error503.html HTTP/1.1\r\nHost:10.24.74.64\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/HTTP_monitor_ACCESS_65 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /INEBAccessibleWeb/resources/html/error503.html HTTP/1.1\r\nHost:10.24.74.65\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/HTTP_monitor_ACCESS_66 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /INEBAccessibleWeb/resources/html/error503.html HTTP/1.1\r\nHost:10.24.74.66\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/HTTP_monitor_ACCESS_67 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /INEBAccessibleWeb/resources/html/error503.html HTTP/1.1\r\nHost:10.24.74.67\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/HTTP_monitor_DIS_17 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv none
    recv-disable none
    send "GET /reindex.html \n User-Agent: Mozilla/5.0 (Linux; Android 13; XQ-CT72 Build/64.1.A.0.891; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/112.0.5615.135 Mobile Safari/537.36 homebank/Worklight/8.0.0.00.2015-12-11T23:31:24Z; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_monitor_DIS_112 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /twrbo/zh_tw/index.html HTTP/1.1\r\nHost:10.248.29.114 \nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_monitor_DIS_114 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /content/dam/twrbo/images/icon/icon_tips.png HTTP/1.1\r\nHost:10.248.29.114 \nUser-Agent: Mozilla/5.0 (Linux; Android 13; XQ-CT72 Build/64.1.A.0.891; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/112.0.5615.135 Mobile Safari/537.36 homebank/Worklight/8.0.0.00.2015-12-11T23:31:24Z; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor http /EBMW/HTTP_monitor_TAG_14 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /jscollection/check.html HTTP/1.1\r\nHost:10.24.123.14\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/HTTP_monitor_TAG_15 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /jscollection/check.html HTTP/1.1\r\nHost:10.24.123.15\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/HTTP_monitor_TAG_16 {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 33
    ip-dscp 0
    recv "200 OK"
    recv-disable none
    send "GET /jscollection/check.html HTTP/1.1\r\nHost:10.24.123.16\r\nUser-Agent: Mozilla/4.0 (compatible; Mozilla/4.0; F5)\r\nConnection: Close\r\n\r\n\r\n"
    time-until-up 0
    timeout 100
}
ltm monitor http /EBMW/http_ebmw {
    adaptive disabled
    defaults-from /Common/http
    destination *:*
    interval 5
    ip-dscp 0
    recv none
    recv-disable none
    send "GET /\r\n"
    time-until-up 0
    timeout 16
}
ltm monitor tcp /EBMW/tcp_10sec {
    adaptive disabled
    defaults-from /Common/tcp
    destination *:*
    interval 5
    ip-dscp 0
    recv none
    recv-disable none
    send none
    time-until-up 0
    timeout 16
}
ltm profile client-ssl /EBMW/EBMW_eb_Profile {
    alert-timeout 10
    allow-non-ssl disabled
    app-service none
    ca-file /Common/TWCA_EV_uca1.crt
    cache-size 262144
    cache-timeout 3600
    cert /Common/EBMW_eb.ctbcbank.com_SSL_2024_new
    cert-key-chain {
        EBMW_eb.ctbcbank_TWCA_EV_uca2_0 {
            cert /Common/EBMW_eb.ctbcbank.com_SSL_2024_new
            chain /Common/TWCA_EV_uca2.crt
            key /Common/EBMW_eb.ctbcbank.com_SSL_2024_new
        }
    }
    chain /Common/TWCA_EV_uca2.crt
    cipher-group none
    ciphers ECDHE:!3DES:!SHA1
    client-cert-ca /Common/TWCA_EV_root.crt
    defaults-from /Common/clientssl
    generic-alert enabled
    handshake-timeout 10
    inherit-ca-certkeychain true
    inherit-certkeychain false
    key /Common/EBMW_eb.ctbcbank.com_SSL_2024_new
    mod-ssl-methods disabled
    mode enabled
    options { dont-insert-empty-fragments no-tlsv1.3 no-tlsv1.1 no-sslv3 no-tlsv1 }
    passphrase none
    proxy-ssl disabled
    renegotiate-max-record-delay indefinite
    renegotiate-period indefinite
    renegotiate-size 1000mb
    renegotiation enabled
    secure-renegotiation require
    server-name none
    session-ticket disabled
    sni-default false
    sni-require false
    ssl-sign-hash any
    strict-resume disabled
    unclean-shutdown enabled
}
ltm profile rewrite /EBMW/rewrite-mft {
    app-service none
    bypass-list none
    client-caching-type cache-css-js
    defaults-from /Common/rewrite
    java-ca-file /Common/ca-bundle.crt
    java-crl none
    java-sign-key /Common/default.key
    java-sign-key-passphrase-encrypted $M$5b$lGkZiLtmcQfv/cz+K7E4sg==
    java-signer /Common/default.crt
    location-specific false
    request {
        insert-xforwarded-for enabled
        insert-xforwarded-host disabled
        insert-xforwarded-proto disabled
        rewrite-headers enabled
    }
    response {
        rewrite-content enabled
        rewrite-headers enabled
    }
    rewrite-list none
    rewrite-mode uri-translation
    split-tunneling false
    uri-rules {
        uri_1628510806387 {
            client {
                path /mfe/
            }
            server {
                host ebmw-mfe-3scale-apicast-production.apps.scp01.ctbcbank.com
                path /
                port 80
                scheme http
            }
        }
    }
}
ltm profile rewrite /EBMW/rewrite-openapi {
    app-service none
    bypass-list none
    client-caching-type cache-css-js
    defaults-from /Common/rewrite
    java-ca-file /Common/ca-bundle.crt
    java-crl none
    java-sign-key /Common/default.key
    java-sign-key-passphrase-encrypted $M$bH$/vvWanaDaa1wO9jxEHRAeg==
    java-signer /Common/default.crt
    location-specific false
    request {
        insert-xforwarded-for enabled
        insert-xforwarded-host disabled
        insert-xforwarded-proto disabled
        rewrite-headers enabled
    }
    response {
        rewrite-content enabled
        rewrite-headers enabled
    }
    rewrite-list none
    rewrite-mode uri-translation
    split-tunneling false
    uri-rules {
        uri_1669369787351 {
            client {
                path /
            }
            server {
                host ebmw-openapi-3scale-apicast-production.apps.scp01.ctbcbank.com
                path /
                port 80
                scheme http
            }
        }
    }
}
security bot-defense asm-profile /EBMW/ASM_SP_EBMW {
    app-service none
}
security bot-defense asm-profile /EBMW/ASM_SP_EBMWIB_CDN {
    app-service none
}
